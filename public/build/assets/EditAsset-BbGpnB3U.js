import{m as Oe,r as i,j as e,V as I,S as H}from"./app-D2Fc9J7r.js";import{A as Ee}from"./Authenticated-Bi7dy8wc.js";import{s as z}from"./index-KE12rTfI.js";import{a as Ie,c as Ne}from"./statusConstants-B9bmVMgg.js";import{A as $}from"./index-CEg2DTkd.js";import{a as Te}from"./chunk-DNIGSRME--Y6ZAwWH.js";import{l as N,s as p}from"./chunk-2C6KNKEU-DB-baBfx.js";import{u as B,m as G,a as W,b as J,c as V,d as Z}from"./index-DipQ1G8P.js";import{F as Ce}from"./chunk-LAX3QLKM-DgxfjCIa.js";import{i as m}from"./chunk-5CAICSBD-C5uePlKw.js";import{b as d}from"./chunk-KCYYJJH4-CFnQEN56.js";import{i as k}from"./chunk-3TCFMHK3-LtiDXk4l.js";import{t as he,a as pe,b as T,c as ue,d as ge,e as C}from"./chunk-F3UDT23P-DI8xBlRF.js";import"./index-CbNZw6my.js";import"./index-K8Flc6f-.js";import"./chunk-SLABUSGS-BiRJdjsi.js";import"./useSingleSelectListState-gE1PoNaV.js";import"./useMenuTriggerState-BWe6aKPw.js";import"./LiveAnnouncer-BVsrsiec.js";function Be({assetDetail:s,products:g,locations:q,employee:u,assetcomponents:x=[]}){var y,L;const{data:t,setData:l,processing:Q}=Oe({EMPLOYEEID:((L=(y=s==null?void 0:s.asset)==null?void 0:y.employee)==null?void 0:L.EMPLOYEEID)||"",PRODUCTID:s.PRODUCTID||"",DESCRIPTION:s.DESCRIPTION||"",MODEL:s.MODEL||"",SERIALNO:s.SERIALNO||"",ISSUEDTO:s.ISSUEDTO||"",DATEISSUUED:s.DATEISSUUED||"",IMAGEPATH:"",SERIALTYPE:s.SERIALTYPE||"",STATUS:s.STATUS||"",ASSETFROM:s.ASSETFROM||"",CONDITIONS:s.CONDITIONS||"",WORKSTAION:s.WORKSTAION||"",TYPESIZE:s.TYPESIZE||"",NOPRINT:s.NOPRINT||"",COMPONENT:s.COMPONENT||"",WITHCOMPONENTS:s.WITHCOMPONENTS||"",SYSTEMASSETID:s.SYSTEMASSETID||"",SYSTEMCOMPONENTID:s.SYSTEMCOMPONENTID||"",LOCATIONID:s.LOCATIONID||""}),{isOpen:X,onOpen:ee,onOpenChange:ne}=B(),{isOpen:se,onOpen:oe,onOpenChange:te}=B(),[re,xe]=i.useState([]),[h,A]=i.useState([...s.component_details||[]]),[O,j]=i.useState(""),[P,f]=i.useState(""),M=n=>{var w,Y,F,K;const o=n.target.value,r=g.find(me=>String(me.PRODUCTID)===String(o));l("PRODUCTID",o),l("DESCRIPTION",((w=r==null?void 0:r.DESCRIPTION)==null?void 0:w.trim())||"");const a=((F=(Y=s==null?void 0:s.asset)==null?void 0:Y.employee)==null?void 0:F.EMPLOYEEID)||t.EMPLOYEEID,S=(K=r==null?void 0:r.asset_component)==null?void 0:K.ASSETCOMPNETID,Se=[a,o,S||null,s.ASSETNUMBER].filter(Boolean).join("-");l("SYSTEMASSETID",Se)},le=()=>{if(!O){I.error("Please select a component.");return}const n=x.find(c=>String(c.ASSETCOMPNETID)===String(O)),a=[...h].filter(c=>String(c.ASSETCOMPNETID)===String(O)).length+1,S={ASSETCOMPNETID:O,COMPONENTNUMBER:a,COMPONENTDESCRIPTION:P,SYSTEMCOMPONENTID:`${t.EMPLOYEEID}-${t.PRODUCTID}-${O}-${a}`,asset_component:n};A(c=>[...c,S]),f(""),j(""),I.success("Component added.")},ae=n=>{A(o=>o.filter((r,a)=>a!==n))},[Ae,D]=i.useState(!1),ce=async n=>{n.preventDefault(),D(!0);try{H.post(z("assets.update",{assetId:s.ASSETID,assetNo:s.ASSETNO}),{...t,COMPONENT:h,WITHCOMPONENTS:re.length>0,existing_images:JSON.stringify(E),new_images:_,_method:"PUT"},{forceFormData:!0,preserveScroll:!0,onSuccess:()=>{I.success("Asset updated successfully!"),H.visit(z("assets.show",{id:s.ASSETID}))},onError:()=>{I.error("Failed to update asset.")}})}catch{I.error("Unexpected error occurred.")}finally{D(!1)}},[v,b]=i.useState([]),[_,R]=i.useState([]),[E,de]=i.useState(()=>{try{return Array.isArray(s.IMAGEPATH)?s.IMAGEPATH:s.IMAGEPATH?JSON.parse(s.IMAGEPATH):[]}catch{return[]}}),ie=n=>{const o=Array.from(n.target.files);R(o);const r=o.map(a=>URL.createObjectURL(a));b(r)},U=n=>{const o=_.filter((S,c)=>c!==n),r=v.filter((S,c)=>c!==n),a=E.filter((S,c)=>c!==n);n<E.length?de(a):(n-E.length,R(o),b(r))};return e.jsx(Ee,{children:e.jsxs("div",{className:"p-3",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Edit Asset"}),e.jsxs("div",{className:"border p-4 rounded-lg mb-6",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Asset ID:"})," ",(s==null?void 0:s.ASSETID)||"--"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Asset Owner:"})," ",(u==null?void 0:u.EMPLOYEENAME)||"--"]})]}),e.jsxs(Ce,{onSubmit:ce,className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"w-full flex gap-2",children:[e.jsx(Te,{label:"Select Product",selectedKey:t.PRODUCTID??null,onSelectionChange:n=>{l("PRODUCTID",n),M({target:{value:n}})},onChange:M,children:g.map(n=>e.jsx(N,{value:n.PRODUCTID,children:n.DESCRIPTION},n.PRODUCTID))}),e.jsx(m,{description:"This is a system generated ID",label:"System Asset ID",value:t.SYSTEMASSETID,isReadOnly:!0,onChange:n=>l("SYSTEMASSETID",n.target.value)})]}),e.jsxs("div",{className:"w-full flex gap-2",children:[e.jsx(m,{className:"w-1/2",label:"Description",value:t.DESCRIPTION,onChange:n=>l("DESCRIPTION",n.target.value)}),e.jsxs(d,{color:"success",variant:"flat",onPress:ee,children:["(",h.length,") Components"]})]}),e.jsxs("div",{className:"w-full flex gap-2",children:[e.jsx(m,{label:"Model",value:t.MODEL,onChange:n=>l("MODEL",n.target.value)}),e.jsx(m,{label:"Serial Number",value:t.SERIALNO,onChange:n=>l("SERIALNO",n.target.value)}),e.jsx(m,{type:"date",label:"Date Issued",value:t.DATEISSUUED?new Date(t.DATEISSUUED.trim()).toISOString().split("T")[0]:"",onChange:n=>l("DATEISSUUED",n.target.value)})]}),e.jsxs("div",{className:"w-full flex gap-4",children:[e.jsx(p,{label:"Status",selectedKeys:t.STATUS?[t.STATUS.trim()]:[],onSelectionChange:n=>l("STATUS",Array.from(n)[0]),children:Ie.map(n=>e.jsx(N,{value:n.value,children:n.label},n.value))}),e.jsx(p,{label:"Condition",selectedKeys:t.CONDITIONS?[t.CONDITIONS.trim()]:[],onSelectionChange:n=>l("CONDITIONS",Array.from(n)[0]),value:t.CONDITIONS,onChange:n=>l("CONDITIONS",n.target.value),children:Ne.map(n=>e.jsx(N,{value:n.value,children:n.label},n.value))}),e.jsx(p,{label:"Location",selectedKeys:[t.LOCATIONID],onSelectionChange:n=>l("LOCATIONID",n.currentKey),onChange:n=>l("LOCATIONID",n.target.value),children:q.map(n=>e.jsx(N,{value:n.LOCATIONID,children:n.LOCATIONNAME},n.LOCATIONID))})]}),e.jsxs("div",{className:"flex gap-4 flex-wrap mb-2",children:[E.map((n,o)=>e.jsxs("div",{className:"relative",children:[e.jsx(k,{src:`/storage/${n}`,alt:`Asset Image ${o+1}`,className:"w-32 h-32 object-cover rounded border"}),e.jsx(d,{color:"danger",variant:"light",className:"z-50 absolute top-0 right-0",onPress:()=>U(o),isIconOnly:!0,children:e.jsx($,{className:"size-4"})})]},o)),v.map((n,o)=>e.jsxs("div",{className:"relative",children:[e.jsx(k,{src:n,alt:`New Image Preview ${o+1}`,className:"w-32 h-32 object-cover rounded border"}),e.jsx(d,{color:"danger",variant:"light",isIconOnly:!0,className:"z-50 absolute top-0 right-0",onPress:()=>U(o),children:e.jsx($,{className:"size-4"})})]},o)),e.jsx(m,{type:"file",multiple:!0,accept:"image/*",onChange:ie})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(d,{type:"submit",color:"primary",children:Q?"Updating...":"Update"}),e.jsx(d,{onPress:()=>window.history.back(),color:"warning",variant:"flat",children:"Cancel"})]})]}),e.jsx(G,{size:"3xl",isOpen:X,onOpenChange:ne,children:e.jsx(W,{children:n=>e.jsxs(e.Fragment,{children:[e.jsx(J,{children:"Components"}),e.jsx(V,{children:e.jsxs(he,{"aria-label":"Component Table",topContent:e.jsx(d,{color:"primary",onPress:oe,children:"Add New Component"}),children:[e.jsxs(pe,{children:[e.jsx(T,{children:"COMPONENTNUMBER"}),e.jsx(T,{children:"COMPONENTNAME"}),e.jsx(T,{children:"DESCRIPTION"}),e.jsx(T,{children:"SYSTEMCOMPONENTID"}),e.jsx(T,{children:"Actions"})]}),e.jsx(ue,{emptyContent:"No components yet.",children:h.map((o,r)=>{var a;return e.jsxs(ge,{children:[e.jsx(C,{children:o.COMPONENTNUMBER}),e.jsx(C,{children:((a=o.asset_component)==null?void 0:a.ASSETCOMPONENTNAME)||"â€”"}),e.jsx(C,{children:o.COMPONENTDESCRIPTION}),e.jsx(C,{children:o.SYSTEMCOMPONENTID}),e.jsx(C,{children:e.jsx(d,{size:"sm",color:"danger",variant:"light",onPress:()=>ae(r),children:"Remove"})})]},r)})})]})}),e.jsx(Z,{children:e.jsx(d,{color:"danger",variant:"light",onPress:n,children:"Close"})})]})})}),e.jsx(G,{size:"xl",isOpen:se,onOpenChange:te,children:e.jsx(W,{children:n=>e.jsxs(e.Fragment,{children:[e.jsx(J,{children:"Add Component"}),e.jsxs(V,{children:[e.jsx(p,{label:"Select Component",selectedKeys:[O],onSelectionChange:o=>j(o.currentKey),children:x.map(o=>e.jsx(N,{value:o.ASSETCOMPNETID,children:o.ASSETCOMPONENTNAME},o.ASSETCOMPNETID))}),e.jsx(m,{label:"Component Description",value:P,onChange:o=>f(o.target.value)}),e.jsx(d,{color:"primary",onPress:le,children:"Add"})]}),e.jsx(Z,{children:e.jsx(d,{color:"danger",variant:"light",onPress:n,children:"Close"})})]})})})]})})}export{Be as default};
