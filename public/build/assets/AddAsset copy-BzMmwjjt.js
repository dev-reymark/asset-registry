import{K as V,r as i,m as B,j as t,L as J,$ as Z,S as y,V as f}from"./app-B0X8LBby.js";import{A as z}from"./Authenticated--06jBr2V.js";import{s as h}from"./index-Z17vvjSM.js";import{b as v}from"./chunk-KCYYJJH4-B9QN_wGJ.js";import{F as Q}from"./chunk-LAX3QLKM-D7v8KnXg.js";import{a as X}from"./chunk-DNIGSRME-sPzYiaNR.js";import{l as u,s as N}from"./chunk-2C6KNKEU-C9aYhCVC.js";import{i as c}from"./chunk-5CAICSBD-BAviX038.js";import{c as ee}from"./chunk-J7I6W5JF-CvasT7CT.js";import"./index-0-18Hqup.js";import"./chunk-SLABUSGS-Bl7IaLmR.js";import"./index-BNwUC09x.js";import"./useFilter-Dr2u7rBG.js";import"./index-BXRWZj2O.js";import"./useSingleSelectListState-DGVtJ0EF.js";import"./useListState-ktyrr1GA.js";import"./useDialog-BsVDVOBe.js";import"./LiveAnnouncer-CDBqPD6z.js";import"./useMenuTriggerState-CtS7Iklo.js";const te=[{label:"Active",value:"Active"},{label:"Defective",value:"Defective"},{label:"For Aquisition",value:"For Aquisition"},{label:"For Repair",value:"For Repair"},{label:"For Replacement",value:"For Replacement"}],se=[{label:"Good",value:"Good"},{label:"Defective",value:"Defective"},{label:"For return to shell",value:"For return to shell"},{label:"Stolen",value:"Stolen"}];function fe(){const{asset:A=[],products:g=[],assetno:U,location:Y,title:C,description:w}=V().props,[E,D]=i.useState(null),[m,x]=i.useState(null),[F,T]=i.useState(""),[S,p]=i.useState([]),[O,P]=i.useState(""),[M,b]=i.useState(!1),_=e=>{var a;if(!e||!((a=e.asset_details)!=null&&a.length))return 1;const s=e.asset_details.map(l=>parseInt(l.ASSETNUMBER)).filter(l=>!isNaN(l));return s.length?Math.max(...s)+1:1},{data:n,setData:r,errors:q,processing:j,reset:$}=B({EMPLOYEEID:"",EMPLOYEENAME:"",ASSETSID:"",ASSETNO:U,PRODUCTID:"",DESCRIPTION:"",MODEL:"",SERIALNO:"",ISSUEDTO:"",DATEISSUUED:"",IMAGEPATH:"",STATUS:"",CONDITIONS:"",WORKSTATION:"",TYPESIZE:"",NOPRINT:"",COMPONENT:"",WITHCOMPONENTS:!1,SYSTEMASSETID:"",SYSTEMCOMPONENTID:"",LOCATIONID:""});i.useEffect(()=>{var e,s,a;if(E&&m){const l=_(E),o=((e=E.employee)==null?void 0:e.EMPLOYEEID)||E.EMPLOYEEID,I=m.PRODUCTID,d=(s=m.asset_component)==null?void 0:s.ASSETCOMPNETID,R=(a=m.asset_component)==null?void 0:a.ASSETCOMPONENTNAME,L=d?`${o}-${I}-${d}-${l}`:`${o}-${I}-${l}`;T(L),r("SYSTEMASSETID",L),r("SYSTEMCOMPONENTID",d||""),r("WITHCOMPONENTS",!!d),p(R?[R]:[])}},[E,m]);const G=e=>{var a,l;const s=A.find(o=>String(o.EMPLOYEEID)===String(e));D(s),r("EMPLOYEEID",(s==null?void 0:s.EMPLOYEEID)||""),r("EMPLOYEENAME",((a=s==null?void 0:s.EMPLOYEENAME)==null?void 0:a.trim())||""),r("ASSETSID",(s==null?void 0:s.ASSETSID)||""),r("ISSUEDTO",((l=s==null?void 0:s.EMPLOYEENAME)==null?void 0:l.trim())||""),console.log("Selected Employee:",s)},H=e=>{var o,I;const s=e.target.value,a=g.find(d=>String(d.PRODUCTID)===String(s));x(a),r("PRODUCTID",s),r("DESCRIPTION",((o=a==null?void 0:a.DESCRIPTION)==null?void 0:o.trim())||"");const l=(I=a==null?void 0:a.asset_component)==null?void 0:I.ASSETCOMPONENTNAME;p(l?[l]:[]),console.log("Selected Product:",a)},K=e=>r("STATUS",e.target.value),W=e=>r("CONDITIONS",e.target.value),k=async e=>{e.preventDefault(),b(!0);const s=S.map(l=>l.trim()),a={...n,COMPONENT:JSON.stringify(s)};try{await y.post(h("assetsextended.store"),a,{forceFormData:!0,preserveScroll:!0,onSuccess:()=>{f.success("Asset added successfully"),y.visit(h("assets.index")),D(null),x(null),T("")},onError:l=>{console.error("Form Errors:",l),f.error("An error occurred while adding the asset.")}})}catch(l){f.error("An unexpected error occurred."),console.error("Submit Error:",l)}finally{b(!1)}};return t.jsxs(z,{children:[t.jsx(J,{title:C}),t.jsx("div",{children:t.jsx(v,{color:"primary",variant:"flat",as:Z,href:h("assets.index"),children:"← Back"})}),t.jsxs("div",{className:"p-6",children:[t.jsx("h2",{className:"text-xl font-semibold text-gray-700",children:C}),t.jsx("p",{className:"text-gray-600 mb-4",children:w}),t.jsxs(Q,{onSubmit:k,className:"w-full flex flex-col gap-y-4",validationErrors:q,encType:"multipart/form-data",children:[t.jsxs("p",{className:"text-sm text-gray-600",children:["Fields marked with"," ",t.jsx("span",{className:"text-red-500",children:"*"})," are required."]}),t.jsxs("div",{className:"w-full grid grid-cols-1 md:grid-cols-2 gap-4",children:[t.jsx(X,{isRequired:!0,label:"Select Employee",selectedKey:n.EMPLOYEEID,onSelectionChange:G,children:A.map(e=>t.jsx(u,{value:e.EMPLOYEEID,textValue:e.EMPLOYEENAME,children:(e.EMPLOYEENAME||"").trim()},e.EMPLOYEEID))}),t.jsxs(N,{isRequired:!0,label:"Select Product",value:n.PRODUCTID,onChange:H,children:[t.jsx(u,{value:"",children:"Select a product"}),g.map(e=>t.jsx(u,{value:e.PRODUCTID,children:(e.DESCRIPTION||"").trim()},e.PRODUCTID))]}),t.jsx(c,{label:"Description",isReadOnly:!0,value:n.DESCRIPTION}),t.jsx("div",{className:"flex gap-2 flex-wrap mt-2",children:S.map((e,s)=>t.jsx(ee,{color:"success",variant:"flat",onClose:()=>p(S.filter(a=>a!==e)),children:e},s))})]}),t.jsx(c,{label:"New Components",value:O,onChange:e=>P(e.target.value),onKeyDown:e=>{e.key==="Enter"&&O.trim()&&(e.preventDefault(),S.includes(O.trim())||(p([...S,O.trim()]),P("")))},description:"Want to add a new component? Press Enter to add."}),t.jsxs("div",{className:"w-full flex gap-4",children:[t.jsx(c,{label:"System Asset ID",value:F,isReadOnly:!0,description:"Auto-generated"}),t.jsx(c,{label:"Model",value:n.MODEL,onChange:e=>r("MODEL",e.target.value),isRequired:!0}),t.jsx(c,{label:"Serial Number",value:n.SERIALNO,onChange:e=>r("SERIALNO",e.target.value),isRequired:!0})]}),t.jsxs("div",{className:"w-full flex gap-4",children:[t.jsx(N,{isRequired:!0,label:"Status",value:n.STATUS,onChange:K,children:te.map(e=>t.jsx(u,{value:e.value,children:e.label},e.value))}),t.jsx(N,{isRequired:!0,label:"Condition",value:n.CONDITIONS,onChange:W,children:se.map(e=>t.jsx(u,{value:e.value,children:e.label},e.value))}),t.jsx(N,{isRequired:!0,label:"Location",value:n.LOCATIONID,onChange:e=>r("LOCATIONID",e.target.value),children:Y.map(e=>t.jsx(u,{value:e.LOCATIONID,children:e.LOCATIONNAME},e.LOCATIONID))})]}),t.jsxs("div",{className:"w-full flex gap-4",children:[t.jsx(c,{label:"Date Issued",type:"date",value:n.DATEISSUUED,onChange:e=>r("DATEISSUUED",e.target.value),isRequired:!0}),t.jsx(c,{label:"Upload Images",type:"file",accept:"image/*",multiple:!0,onChange:e=>r("IMAGEPATH",Array.from(e.target.files))})]}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx(v,{type:"submit",color:"primary",isLoading:M,isDisabled:j,children:M?"Adding...":"Add Asset"}),t.jsx(v,{type:"button",color:"warning",variant:"flat",onPress:()=>{$(),D(null),x(null),T("")},isDisabled:j,children:"Reset"})]})]})]})]})}export{fe as default};
