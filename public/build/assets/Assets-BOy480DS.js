import{j as e,K as es,r as o,L as ss,$ as je,S as D,V as A}from"./app-DFx-ZtG3.js";import{A as as,M as ts}from"./Authenticated-DVH5mXuD.js";import{u as rs}from"./useDebounce-BCLwgO07.js";import{C as ns}from"./index-CWYJjJEF.js";import{G as Ne,s as g}from"./index-2biP6vnG.js";import{F as ls}from"./swiper-DFdJsTNW.js";import{t as Se,H as is}from"./index-npxyYHeM.js";import{A as os}from"./AssetComponents-tVQYU8pH.js";import{s as cs,n as K}from"./statusConstants-B9bmVMgg.js";import{S as ds,a as hs}from"./swiper-react-Bu5rmP4a.js";import{m as Y,a as H,b as B,c as G,d as $,u as I}from"./index-CrpbuSSF.js";import{i as us}from"./chunk-3TCFMHK3-BVqYb2AG.js";import{b as d}from"./chunk-KCYYJJH4-BFH73BT_.js";import{s as E,l as y}from"./chunk-2C6KNKEU-Bix1_CrN.js";import{i as W}from"./chunk-5CAICSBD-DT7OHrRn.js";import{d as ge,a as ve,b as _e,m as V}from"./chunk-Z2IJA2C6-D9coAzBB.js";import{b as xs}from"./chunk-57V4RE7B-CBQPTv_1.js";import{t as ps,a as ms,b as v,c as fs,d as js,e as _}from"./chunk-F3UDT23P-BZMqUIk3.js";import{c as Ss}from"./chunk-J7I6W5JF-CfhTNHHs.js";import"./useMenuTriggerState-DoKsCLgg.js";import"./index-BVsX1ZXD.js";import"./chunk-SLABUSGS-BatiFHUF.js";import"./index-HxHfWmo6.js";import"./LiveAnnouncer-DeJH0nSd.js";const gs=({isOpen:u,selectedAsset:r,onOpenChange:j,onComponentModalOpen:f})=>{var x;const h=(x=r==null?void 0:r.asset_details)==null?void 0:x[0],i=h==null?void 0:h.latest_scan;return e.jsx(Y,{isOpen:u,size:"xl",placement:"top-center",onOpenChange:j,children:e.jsx(H,{children:N=>{var S,p,m,c,l,n,b;return e.jsxs(e.Fragment,{children:[e.jsx(B,{className:"flex flex-col gap-1",children:"Assets Details"}),e.jsx(G,{children:r&&e.jsxs("div",{className:"flex flex-wrap gap-6",children:[e.jsx(ds,{spaceBetween:10,slidesPerView:1,className:"w-full sm:w-1/2 lg:w-1/3",children:((S=r==null?void 0:r.asset_details[0])==null?void 0:S.IMAGEPATH)&&JSON.parse(r.asset_details[0].IMAGEPATH).map((t,O)=>e.jsx(hs,{children:e.jsx(us,{src:`/storage/${t}`,alt:`Asset Image ${O+1}`,className:"object-cover",width:400,height:200,onError:w=>w.target.src="/assets/placeholder.jpg"})},O))}),e.jsxs("div",{className:"flex-1 space-y-4 text-sm text-gray-700",children:[e.jsxs("p",{children:[e.jsx("span",{className:"font-semibold",children:"Description:"})," ",(p=r.asset_details[0])==null?void 0:p.DESCRIPTION]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-semibold",children:"Serial Number:"})," ",(m=r.asset_details[0])==null?void 0:m.SERIALNO]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-semibold",children:"Date Issued:"})," ",(l=(c=r.asset_details[0])==null?void 0:c.DATEISSUUED)==null?void 0:l.trim()]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-semibold",children:"Condition:"})," ",(n=r.asset_details[0])==null?void 0:n.CONDITIONS]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-semibold",children:"Last Audit:"})," ",(b=i==null?void 0:i.changes)!=null&&b.scanned_at?new Date(i.changes.scanned_at).toLocaleString():"--"]}),e.jsx(d,{color:"primary",variant:"light",onPress:f,children:"View components"})]})]})}),e.jsx($,{children:e.jsx(d,{color:"danger",variant:"flat",onPress:N,children:"Close"})})]})}})})},vs=({isTransferOpen:u,onTransferOpenChange:r,employees:j,location:f,selectedEmployeeId:h,setSelectedEmployeeId:i,selectedLocationId:x,setSelectedLocationId:N,statusToTransfer:S,setStatusToTransfer:p,newStatus:m,selectedKeys:c,handleTransferAssets:l,loading:n})=>e.jsx(Y,{isOpen:u,onOpenChange:r,children:e.jsx(H,{children:b=>e.jsxs(e.Fragment,{children:[e.jsxs(B,{className:"flex flex-col gap-1",children:[e.jsx("h1",{className:"text-lg font-semibold",children:"Transfer Assets"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Select a location, employee and status to transfer the selected assets."})]}),e.jsxs(G,{children:[e.jsx(E,{label:"Select Employee",value:h,onChange:t=>i(t.target.value),children:j.map((t,O)=>t.EMPLOYEEID?e.jsx(y,{value:t.EMPLOYEEID,children:t.EMPLOYEENAME},t.EMPLOYEEID):null)}),e.jsx(E,{label:"Select Location",value:x,onChange:t=>N(t.target.value),children:f.map(t=>e.jsx(y,{value:t.LOCATIONID,children:t.LOCATIONNAME},t.LOCATIONID))}),e.jsx(E,{label:"Select Status",value:S,onChange:t=>p(t.target.value),children:m.map(t=>e.jsx(y,{value:t.value,children:t.label},t.value))})]}),e.jsxs($,{children:[e.jsx(d,{color:"danger",variant:"light",onPress:b,children:"Cancel"}),e.jsx(d,{color:"primary",onPress:()=>{l(Array.from(c),x,h),b()},isDisabled:!x||!h,isLoading:n,children:n?"Transferring...":"Transfer"})]})]})})}),_s=({isArchiveOpen:u,onArchiveOpenChange:r,statusToArchive:j,setStatusToArchive:f,reason:h,setReason:i,condition:x,setCondition:N,handleArchiveAssets:S,selectedAsset:p,archiveLoading:m,newStatus:c})=>e.jsx(Y,{isOpen:u,onOpenChange:r,placement:"top-center",children:e.jsx(H,{children:l=>e.jsxs(e.Fragment,{children:[e.jsxs(B,{className:"flex flex-col gap-1",children:[e.jsx("h1",{className:"text-lg font-semibold text-danger-500",children:"Are you sure you want to dispose?"}),e.jsxs(G,{className:"",children:[e.jsx(Se,{isRequired:!0,label:"Reason for disposal",value:h,onChange:n=>i(n.target.value)}),e.jsx(E,{isRequired:!0,variant:"faded",label:"Select Status",value:j,onChange:n=>f(n.target.value),children:c.map(n=>e.jsx(y,{value:n.value,children:n.label},n.value))}),e.jsx(Se,{variant:"faded",isRequired:!0,label:"Asset Condition",value:x,onChange:n=>N(n.target.value)})]})]}),e.jsxs($,{children:[e.jsx(d,{color:"danger",variant:"light",onPress:l,children:"Cancel"}),e.jsx(d,{color:"primary",onPress:()=>{S(p.asset_details.map(n=>n.ASSETNO)),l()},isDisabled:!h||!x,isLoading:m,children:m?"Disposing...":"Dispose"})]})]})})}),Ns=({location:u,selectedLocationId:r,setSelectedLocationId:j,statusToTransfer:f,setStatusToTransfer:h,newStatus:i,selectedKeys:x,isDeclassificationOpen:N,onDeclassificationOpenChange:S,handleDeclassification:p,loading:m})=>e.jsx(Y,{isOpen:N,onOpenChange:S,children:e.jsx(H,{children:c=>e.jsxs(e.Fragment,{children:[e.jsxs(B,{className:"flex flex-col gap-1",children:[e.jsx("h1",{className:"text-lg font-semibold",children:"Declassify Assets"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Select a location and status to declassify the selected assets."})]}),e.jsxs(G,{children:[e.jsx(E,{label:"Select Location",value:r,onChange:l=>j(l.target.value),children:u.map(l=>e.jsx(y,{value:l.LOCATIONID,children:l.LOCATIONNAME},l.LOCATIONID))}),e.jsx(E,{label:"Select Status",value:f,onChange:l=>h(l.target.value),children:i.map(l=>e.jsx(y,{value:l.value,children:l.label},l.value))})]}),e.jsxs($,{children:[e.jsx(d,{color:"danger",variant:"light",onPress:c,children:"Cancel"}),e.jsx(d,{color:"primary",onPress:()=>{p(Array.from(x),r),c()},isDisabled:!r||!f,isLoading:m,children:m?"Declassifying...":"Declassify"})]})]})})});function bs(u){return Ne({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polyline",attr:{points:"15 14 20 9 15 4"},child:[]},{tag:"path",attr:{d:"M4 20v-7a4 4 0 0 1 4-4h12"},child:[]}]})(u)}function Ds(u){return Ne({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"line",attr:{x1:"12",y1:"5",x2:"12",y2:"19"},child:[]},{tag:"line",attr:{x1:"5",y1:"12",x2:"19",y2:"12"},child:[]}]})(u)}function Xs(){const{employees:u,assets:r,location:j,title:f,desc:h,filters:i={},descriptions:x,statuses:N,issuedTos:S}=es().props,[p,m]=o.useState(i.search||""),[c,l]=o.useState(i.sort||""),[n,b]=o.useState(i.start_date||""),[t,O]=o.useState(i.end_date||""),[w,be]=o.useState(i.description||""),[J,De]=o.useState(i.status||""),[Q,Oe]=o.useState(i.issued_to||""),[Ce,Os]=o.useState(i.sort_field||""),[Ae,Cs]=o.useState(i.sort_direction||""),{isOpen:Ee,onOpen:ye,onOpenChange:Te}=I(),[q,X]=o.useState(null),[T,L]=o.useState(new Set),[M,P]=o.useState(""),F=(a,s)=>{D.get(g("assets.index"),{search:p,sort:c,start_date:a,end_date:s},{preserveState:!0,replace:!0})},Ie=a=>{const s=a.target.value;b(s),F(s,t)},we=a=>{const s=a.target.value;O(s),F(n,s)},Le=rs(a=>{D.get(g("assets.index"),{search:a,sort:c},{preserveState:!0,replace:!0})},300),Me=a=>{const s=a.target.value;m(s),Le(s)},Pe=()=>{m(""),D.get(g("assets.index"),{search:"",sort:c})},Fe=()=>{const a=c==="name_asc"?"name_desc":"name_asc";l(a),D.get(g("assets.index"),{search:p,sort:a},{preserveState:!0,replace:!0})},Re=a=>{D.get(g("assets.index"),{search:p,sortField:Ce,sortDirection:Ae,start_date:n,end_date:t,description:w,status:J,issued_to:Q,...a},{preserveState:!0,replace:!0})},{isOpen:ke,onOpen:ze,onOpenChange:Ue}=I(),{isOpen:Ve,onOpen:Ye,onOpenChange:He}=I(),[Z,R]=o.useState(""),[ee,k]=o.useState(!1),[Be,se]=o.useState(""),Ge=(a,s,z)=>{const C=a.map(Number);k(!0),D.post(g("assetsextended.transfer"),{asset_nos:C,location_id:s,employee_id:z,status:M},{preserveState:!0,replace:!0,onSuccess:()=>{L(new Set),R(""),se(""),P(""),A.success("Assets transferred successfully.")},onError:U=>{console.error("Transfer failed:",U),A.error("Failed to transfer assets.")},onFinish:()=>{k(!1)}})},$e=(a,s)=>{const z=a.map(Number);k(!0),D.post(g("assetsextended.declassify"),{asset_nos:z,location_id:s,status:M},{preserveState:!0,replace:!0,onSuccess:()=>{L(new Set),R(""),P(""),A.success("Assets transferred successfully.")},onError:C=>{console.error("Transfer failed:",C),A.error("Failed to transfer assets.")},onFinish:()=>{k(!1)}})},{isOpen:qe,onOpen:Ke,onOpenChange:We}=I(),[ae,te]=o.useState(""),[re,ne]=o.useState(""),[le,ie]=o.useState(!1),[oe,ce]=o.useState(""),Je=a=>{ie(!0),D.post(g("assetsextended.archive",{assetNo:a}),{status:oe,archival_reason:ae,conditions:re},{preserveState:!0,replace:!0,onSuccess:()=>{L(new Set),ce(""),te(""),ne(""),A.success("Assets archived successfully.")},onError:s=>{console.error("Archive failed:",s),A.error("Failed to archive assets.")},onFinish:()=>{ie(!1)}})},{isOpen:Qe,onOpen:Xe,onOpenChange:Ze}=I();return e.jsxs(as,{children:[e.jsx(ss,{title:f}),e.jsxs("div",{className:"p-6",children:[e.jsx("h1",{className:"text-2xl font-bold mb-4",children:f}),e.jsx("p",{className:"text-gray-600 mb-4",children:h}),e.jsxs("div",{className:"flex justify-between mb-4",children:[e.jsx(W,{isClearable:!0,className:"w-full sm:max-w-[44%]",placeholder:"Search by name, description...",startContent:e.jsx(ns,{className:"size-5"}),value:p,onClear:Pe,onChange:Me}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(ls,{statuses:N,status:J,setStatus:De,descriptions:x,description:w,setDescription:be,issuedTos:S,issuedTo:Q,applyFilters:Re,setIssuedTo:Oe}),e.jsxs(ge,{children:[e.jsx(ve,{children:e.jsx(d,{variant:"bordered",children:"Filter by Date Issued"})}),e.jsx(_e,{"aria-label":"Filter by Date Issued",className:"p-2 w-72",closeOnSelect:!1,children:e.jsx(V,{className:"cursor-default",children:e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsx(W,{type:"date",label:"Start Date",value:n,onChange:Ie}),e.jsx(W,{type:"date",label:"End Date",value:t,onChange:we}),e.jsxs("div",{className:"flex justify-end gap-2 mt-2",children:[e.jsx(d,{color:"primary",onPress:()=>F(n,t),children:"Apply"}),e.jsx(d,{color:"warning",variant:"flat",onPress:()=>{b(""),O(""),F("","")},children:"Clear"})]})]})},"filter")})]})]})]}),e.jsxs("div",{className:"flex w-full flex-col",children:[e.jsx("div",{className:"flex justify-start items-center mb-4 gap-2",children:e.jsxs(xs,{children:[e.jsx(d,{color:"primary",as:je,variant:"flat",startContent:e.jsx(Ds,{className:"size-5"}),href:g("assetsextended.create"),children:"Add Asset"}),e.jsx(d,{color:"success",variant:"flat",startContent:e.jsx(bs,{className:"size-5"}),onPress:ze,isDisabled:T.size===0,children:"Transfer Asset"}),e.jsx(d,{color:"secondary",variant:"flat",startContent:e.jsx(ts,{className:"size-5"}),onPress:Ye,isDisabled:T.size===0,children:"Declassification"})]})}),e.jsxs(ps,{isCompact:!0,isHeaderSticky:!0,isVirtualized:!0,maxTableHeight:"calc(100vh - 300px)",selectionMode:"multiple",selectedKeys:T,onSelectionChange:L,"aria-label":"Employee Assets table",isStriped:!0,children:[e.jsxs(ms,{className:"sticky top-0 bg-white z-10",children:[e.jsx(v,{children:"Asset #"}),e.jsx(v,{children:"System Asset ID"}),e.jsx(v,{children:"Description"}),e.jsx(v,{children:"Model"}),e.jsx(v,{children:"Serial No"}),e.jsxs(v,{onClick:Fe,style:{cursor:"pointer"},children:["EMPLOYEE",c==="name_asc"&&" 🔼",c==="name_desc"&&" 🔽",!["name_asc","name_desc"].includes(c)&&" ⏺️"]}),e.jsx(v,{children:"Location"}),e.jsx(v,{children:"Status"}),e.jsx(v,{children:"Date Issued"}),e.jsx(v,{children:"Actions"})]}),e.jsx(fs,{emptyContent:"No rows to display.",children:r.filter(a=>a.asset_details.some(s=>parseInt(s.archived)===0)).map(a=>a.asset_details.filter(s=>parseInt(s.archived)===0).map((s,z)=>{var C,U,de,he,ue,xe,pe,me,fe;return e.jsxs(js,{children:[e.jsx(_,{children:(C=s.ASSETNUMBER)==null?void 0:C.trim()}),e.jsx(_,{children:(U=s.SYSTEMASSETID)==null?void 0:U.trim()}),e.jsx(_,{children:(de=s.DESCRIPTION)==null?void 0:de.trim()}),e.jsx(_,{children:(he=s.MODEL)==null?void 0:he.trim()}),e.jsx(_,{children:(ue=s.SERIALNO)==null?void 0:ue.trim()}),e.jsx(_,{children:(xe=a.EMPLOYEENAME)==null?void 0:xe.trim()}),e.jsx(_,{children:(pe=s==null?void 0:s.location.LOCATIONNAME)==null?void 0:pe.trim()}),e.jsx(_,{children:e.jsx(Ss,{variant:"flat",color:cs[(me=s.STATUS)==null?void 0:me.trim()]||"default",radius:"md",children:(fe=s.STATUS)==null?void 0:fe.trim()})}),e.jsx(_,{children:s.DATEISSUUED?new Date(s.DATEISSUUED.trim()).toLocaleDateString():"--"}),e.jsx(_,{children:e.jsxs(ge,{children:[e.jsx(ve,{children:e.jsx(d,{isIconOnly:!0,size:"sm",variant:"light",children:e.jsx(is,{size:20,className:"text-default-800"})})}),e.jsxs(_e,{children:[e.jsx(V,{onPress:()=>{X({...a,asset_details:[s]}),ye()},children:"View"},"view"),e.jsx(V,{as:je,href:g("assetsextended.edit",s.ASSETNO),children:"Update"},"update"),e.jsx(V,{className:"text-danger",color:"danger",onPress:()=>{X({...a,asset_details:[s]}),Ke()},children:"Dispose"},"dispose")]})]})})]},s.ASSETNO)}))})]})]}),e.jsx(gs,{selectedAsset:q,isOpen:Ee,onOpenChange:Te,onComponentModalOpen:Xe}),e.jsx(os,{onComponentModalOpenChange:Ze,selectedAsset:q,isComponentModalOpen:Qe}),e.jsx(vs,{isTransferOpen:ke,onTransferOpenChange:Ue,employees:u,location:j,selectedEmployeeId:Be,setSelectedEmployeeId:se,selectedLocationId:Z,setSelectedLocationId:R,statusToTransfer:M,setStatusToTransfer:P,newStatus:K,selectedKeys:T,handleTransferAssets:Ge,loading:ee}),e.jsx(Ns,{location:j,selectedLocationId:Z,setSelectedLocationId:R,statusToTransfer:M,setStatusToTransfer:P,newStatus:K,selectedKeys:T,isDeclassificationOpen:Ve,onDeclassificationOpenChange:He,handleDeclassification:$e,loading:ee}),e.jsx(_s,{isArchiveOpen:qe,onArchiveOpenChange:We,reason:ae,setReason:te,statusToArchive:oe,setStatusToArchive:ce,condition:re,setCondition:ne,handleArchiveAssets:Je,loading:le,selectedAsset:q,archiveLoading:le,newStatus:K})]})]})}export{Xs as default};
