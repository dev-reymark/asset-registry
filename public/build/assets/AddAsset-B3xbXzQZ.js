import{K as le,r as i,m as ne,j as e,L as oe,$ as de,V as E,S as $}from"./app-DFx-ZtG3.js";import{A as ie}from"./Authenticated-DVH5mXuD.js";import{s as A}from"./index-2biP6vnG.js";import{b as ce,d as ue}from"./statusConstants-B9bmVMgg.js";import{u as Ee,m as Se,a as me,b as Ie,c as Oe,d as pe}from"./index-CrpbuSSF.js";import{b as S}from"./chunk-KCYYJJH4-BFH73BT_.js";import{F as Ne}from"./chunk-LAX3QLKM-5hwvGJjS.js";import{a as w}from"./chunk-DNIGSRME-D0alPh8j.js";import{l as O,s as D}from"./chunk-2C6KNKEU-Bix1_CrN.js";import{i as m}from"./chunk-5CAICSBD-DT7OHrRn.js";import{t as Te,a as De,b as P,c as Ce,d as xe,e as M}from"./chunk-F3UDT23P-BZMqUIk3.js";import"./useMenuTriggerState-DoKsCLgg.js";import"./index-BVsX1ZXD.js";import"./chunk-SLABUSGS-BatiFHUF.js";import"./index-HxHfWmo6.js";import"./useFilter-CPyQg9n4.js";import"./useSingleSelectListState-Bc4Jztec.js";import"./LiveAnnouncer-DeJH0nSd.js";function Fe(){const{asset:g=[],assetcomponents:j=[],products:b=[],assetno:q,location:F,title:v,description:H}=le().props,[o,C]=i.useState(null),[d,x]=i.useState(null),[W,h]=i.useState(""),[R,L]=i.useState(!1),{isOpen:K,onOpen:V,onOpenChange:k}=Ee(),[f,B]=i.useState(""),[y,_]=i.useState(""),[p,G]=i.useState([]),z=s=>{var a;if(!s||!((a=s.asset_details)!=null&&a.length))return 1;const t=s.asset_details.map(l=>parseInt(l.ASSETNUMBER)).filter(l=>!isNaN(l));return t.length?Math.max(...t)+1:1},{data:n,setData:r,errors:Z,processing:Y,reset:J}=ne({EMPLOYEEID:"",EMPLOYEENAME:"",ASSETSID:"",ASSETNO:q,PRODUCTID:"",DESCRIPTION:"",MODEL:"",SERIALNO:"",ISSUEDTO:"",DATEISSUUED:"",IMAGEPATH:"",STATUS:"",CONDITIONS:"",WORKSTATION:"",TYPESIZE:"",NOPRINT:"",COMPONENT:null,WITHCOMPONENTS:!1,SYSTEMASSETID:"",SYSTEMCOMPONENTID:"",LOCATIONID:""});i.useEffect(()=>{var s,t,a;if(o&&d){const l=z(o),c=((s=o.employee)==null?void 0:s.EMPLOYEEID)||o.EMPLOYEEID,N=d.PRODUCTID,u=(t=d.asset_component)==null?void 0:t.ASSETCOMPNETID;(a=d.asset_component)==null||a.ASSETCOMPONENTNAME;const T=u?`${c}-${N}-${u}-${l}`:`${c}-${N}-${l}`;h(T),r("SYSTEMASSETID",T),r("SYSTEMCOMPONENTID",u||""),r("WITHCOMPONENTS",!!u)}},[o,d]);const Q=s=>{var a,l;const t=g.find(c=>String(c.EMPLOYEEID)===String(s));C(t),r("EMPLOYEEID",(t==null?void 0:t.EMPLOYEEID)||""),r("EMPLOYEENAME",((a=t==null?void 0:t.EMPLOYEENAME)==null?void 0:a.trim())||""),r("ASSETSID",(t==null?void 0:t.ASSETSID)||""),r("ISSUEDTO",((l=t==null?void 0:t.EMPLOYEENAME)==null?void 0:l.trim())||"")},X=s=>{var l;const t=s,a=b.find(c=>String(c.PRODUCTID)===String(t));x(a),r("PRODUCTID",t),r("DESCRIPTION",((l=a==null?void 0:a.DESCRIPTION)==null?void 0:l.trim())||"")},ee=s=>r("STATUS",s.target.value),se=s=>r("CONDITIONS",s.target.value),te=async s=>{s.preventDefault(),L(!0);const t={...n};try{$.post(A("assetsextended.store"),t,{forceFormData:!0,preserveScroll:!0,onSuccess:()=>{E.success("Asset added successfully"),$.visit(A("assets.index")),C(null),x(null),h("")},onError:a=>{console.error("Form Errors:",a),E.error("An error occurred while adding the asset.")}})}catch(a){E.error("An unexpected error occurred."),console.error("Submit Error:",a)}finally{L(!1)}},ae=()=>{const s=j.find(t=>Number(t.ASSETCOMPNETID)===Number(f));if(s){const t=o==null?void 0:o.EMPLOYEEID,a=d==null?void 0:d.PRODUCTID;if(!t||!a){E.error("Employee or Product not selected properly.");return}const l=`${t}-${a}-${s.ASSETCOMPNETID}`,N=p.filter(I=>I.SYSTEMCOMPONENTID.startsWith(l)).reduce((I,re)=>{const U=parseInt(re.SYSTEMCOMPONENTID.split("-").pop(),10);return U>I?U:I},0)+1,u=`${t}-${a}-${s.ASSETCOMPNETID}-${N}`,T={...s,DESCRIPTION:y,SYSTEMCOMPONENTID:u};G(I=>[...I,T]),_(""),E.success(`Component ${u} added successfully.`)}else E.error("Component not found.")};return e.jsxs(ie,{children:[e.jsx(oe,{title:v}),e.jsx("div",{children:e.jsx(S,{color:"primary",variant:"flat",as:de,href:A("assets.index"),children:"← Back"})}),e.jsxs("div",{className:"p-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-700",children:v}),e.jsx("p",{className:"text-gray-600 mb-4",children:H}),e.jsxs(Ne,{onSubmit:te,className:"w-full flex flex-col gap-y-4",validationErrors:Z,encType:"multipart/form-data",children:[e.jsxs("p",{className:"text-sm text-gray-600",children:["Fields marked with"," ",e.jsx("span",{className:"text-red-500",children:"*"})," are required."]}),e.jsxs("div",{className:"w-full grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(w,{isRequired:!0,label:"Select Employee",selectedKey:n.EMPLOYEEID,onSelectionChange:Q,children:g.map(s=>e.jsx(O,{value:s.EMPLOYEEID,textValue:s.EMPLOYEENAME,children:(s.EMPLOYEENAME||"").trim()},s.EMPLOYEEID))}),e.jsx(w,{isRequired:!0,label:"Select Product",onSelectionChange:X,selectedKey:n.PRODUCTID,children:b.map(s=>e.jsx(O,{value:s.PRODUCTID,textValue:s.DESCRIPTION,children:(s.DESCRIPTION||"").trim()},s.PRODUCTID))}),e.jsx(m,{label:"Description",isReadOnly:!0,value:n.DESCRIPTION})]}),e.jsx(S,{isDisabled:!n.PRODUCTID||!n.EMPLOYEEID,color:"primary",onPress:V,children:"Add Component"}),e.jsxs("div",{className:"w-full flex gap-4",children:[e.jsx(m,{label:"System Asset ID",value:W,isReadOnly:!0,description:"Auto-generated"}),e.jsx(m,{label:"Model",value:n.MODEL,onChange:s=>r("MODEL",s.target.value),isRequired:!0}),e.jsx(m,{label:"Serial Number",value:n.SERIALNO,onChange:s=>r("SERIALNO",s.target.value),isRequired:!0})]}),e.jsxs("div",{className:"w-full flex gap-4",children:[e.jsx(D,{isRequired:!0,label:"Status",value:n.STATUS,onChange:ee,children:ce.map(s=>e.jsx(O,{value:s.value,children:s.label},s.value))}),e.jsx(D,{isRequired:!0,label:"Condition",value:n.CONDITIONS,onChange:se,children:ue.map(s=>e.jsx(O,{value:s.value,children:s.label},s.value))}),e.jsx(D,{isRequired:!0,label:"Location",value:n.LOCATIONID,onChange:s=>r("LOCATIONID",s.target.value),children:F.map(s=>e.jsx(O,{value:s.LOCATIONID,children:s.LOCATIONNAME},s.LOCATIONID))})]}),e.jsxs("div",{className:"w-full flex gap-4",children:[e.jsx(m,{label:"Date Issued",type:"date",value:n.DATEISSUUED,onChange:s=>r("DATEISSUUED",s.target.value),isRequired:!0}),e.jsx(m,{label:"Upload Images",type:"file",accept:"image/*",multiple:!0,onChange:s=>r("IMAGEPATH",Array.from(s.target.files))})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(S,{type:"submit",color:"primary",isLoading:R,isDisabled:Y,children:R?"Adding...":"Add Asset"}),e.jsx(S,{type:"button",color:"warning",variant:"flat",onPress:()=>{J(),C(null),x(null),h("")},isDisabled:Y,children:"Reset"})]})]}),e.jsx(Se,{hideCloseButton:!0,isOpen:K,onOpenChange:k,size:"2xl",children:e.jsx(me,{children:s=>e.jsxs(e.Fragment,{children:[e.jsx(Ie,{className:"flex flex-col gap-1",children:"Add Component"}),e.jsxs(Oe,{children:[e.jsx(D,{isRequired:!0,label:"Select Component",value:f,onChange:t=>B(t.target.value),children:j.map(t=>e.jsx(O,{value:t.ASSETCOMPNETID,children:t.ASSETCOMPONENTNAME},t.ASSETCOMPNETID))}),e.jsx(m,{label:"Component Description",value:y,onChange:t=>_(t.target.value)}),e.jsx(S,{color:"primary",isDisabled:!f,onPress:ae,children:"Add"}),e.jsxs(Te,{"aria-label":"Components Table",children:[e.jsxs(De,{children:[e.jsx(P,{children:"Component Name"}),e.jsx(P,{children:"Description"}),e.jsx(P,{children:"System Component ID"})]}),e.jsx(Ce,{emptyContent:"No rows to display.",children:p.map(t=>e.jsxs(xe,{children:[e.jsx(M,{children:t.ASSETCOMPONENTNAME}),e.jsx(M,{children:t.DESCRIPTION}),e.jsx(M,{children:t.SYSTEMCOMPONENTID})]},t.ASSETCOMPNETID))})]})]}),e.jsxs(pe,{children:[e.jsx(S,{color:"danger",variant:"light",onPress:s,children:"Close"}),e.jsx(S,{color:"primary",onPress:()=>{r("COMPONENT",p),r("WITHCOMPONENTS",p.length>0),s(),E.success("Components added successfully.")},children:"Continue"})]})]})})})]})]})}export{Fe as default};
