import{R as j,j as e,L as F,S as Y}from"./app-B0X8LBby.js";import{A as $}from"./Authenticated--06jBr2V.js";import{s as g}from"./index-Z17vvjSM.js";import{C as V}from"./index-BEYtlNV7.js";import{$ as T,d as B}from"./chunk-47PLNLHE-BfKC5jwx.js";import{b as q}from"./chunk-KCYYJJH4-B9QN_wGJ.js";import{l as z}from"./chunk-T45N425O-BGFuk9kE.js";import{t as H,a as E}from"./chunk-ML27DD5T-CzmepFGm.js";import{t as Q,a as Z,b as S,c as G,d as J,e as _}from"./chunk-F3UDT23P-EQ_dTb7a.js";import{p as W}from"./chunk-YHY32LNM-Dou4JBNO.js";import{i as X}from"./chunk-5CAICSBD-BAviX038.js";import"./index-0-18Hqup.js";import"./useDialog-BsVDVOBe.js";import"./index-BXRWZj2O.js";import"./chunk-SLABUSGS-Bl7IaLmR.js";import"./index-BNwUC09x.js";import"./useFilter-Dr2u7rBG.js";import"./LiveAnnouncer-CDBqPD6z.js";import"./useListState-ktyrr1GA.js";import"./index-CokAva9Y.js";import"./features-animation-DQcXFvtm.js";import"./features-max-BoktI70t.js";import"./useSingleSelectListState-DGVtJ0EF.js";function ge({histories:d,filters:i,actions:b}){const[A,C]=j.useState(i.search||""),[O,D]=j.useState(i.action||""),[I,w]=j.useState({start:i.start_date?T(i.start_date+"T00:00[UTC]"):null,end:i.end_date?T(i.end_date+"T23:59[UTC]"):null}),v=d.per_page||10,L=d.last_page||Math.ceil(d.total/v),h=({page:t=1,search:c=null,action:u=null,start_date:x=null,end_date:n=null}={})=>{Y.get(g("history.index"),{page:t,search:c??i.search,action:u??i.action,start_date:x??i.start_date,end_date:n??i.end_date},{preserveState:!0,replace:!0})},M=t=>{h({page:t})},U=t=>{C(t.target.value),h({search:t.target.value,page:1})},P=t=>{D(t),h({action:t,page:1})},R=t=>{w(t),t!=null&&t.start&&(t!=null&&t.end)&&h({page:1,start_date:t.start.toString().slice(0,10),end_date:t.end.toString().slice(0,10)})},N=()=>e.jsxs(Q,{isStriped:!0,"aria-label":"Audit log table with pagination",topContent:e.jsxs("div",{className:"flex flex-col gap-4 md:flex-row md:items-center md:justify-between",children:[e.jsx(X,{className:"w-full md:max-w-sm",placeholder:"Search user...",startContent:e.jsx(V,{className:"size-5"}),value:A,onChange:U}),e.jsx("div",{className:"w-full flex flex-col gap-4 md:flex-row md:items-center md:justify-end",children:e.jsx(B,{hideTimeZone:!0,label:"Filter by Date",visibleMonths:2,value:I,onChange:R,className:"w-full md:w-auto"})})]}),bottomContent:e.jsx("div",{className:"flex w-full justify-center",children:e.jsx(W,{isCompact:!0,showControls:!0,showShadow:!0,color:"secondary",page:d.current_page,total:L,onChange:M})}),classNames:{wrapper:"min-h-[222px]"},children:[e.jsxs(Z,{children:[e.jsx(S,{children:"User"},"user.name"),e.jsx(S,{children:"Action"},"action"),e.jsx(S,{children:"Description"},"changes"),e.jsx(S,{children:"Date Created"},"created_at")]}),e.jsx(G,{items:d.data,emptyContent:"No history found",children:t=>e.jsx(J,{children:c=>{var u,x;if(c==="changes"){const n=t.changes,m=(n==null?void 0:n.from)||{},l=(n==null?void 0:n.to)||{},f={ASSETNUMBER:"Asset Number",EMPLOYEENAME:"Employee Name",SYSTEMASSETID:"System Asset ID",LOCATIONNAME:"Location Name",LOCATIONID:"Location ID",EMPLOYEEID:"Employee ID",STATUS:"Status"},a=[];if(t.action==="archive")a.push(e.jsx("li",{className:"text-red-600 font-semibold",children:"📦 Asset Archived"},"archived_flag")),["SYSTEMASSETID"].forEach(s=>{l[s]&&a.push(e.jsxs("li",{children:[e.jsxs("strong",{children:[f[s]||s,":"]})," ",l[s]]},s))}),m.STATUS!==l.STATUS&&a.push(e.jsxs("li",{children:["Status from"," ",e.jsx("em",{children:m.STATUS||"—"})," ","to"," ",e.jsx("strong",{children:l.STATUS||"—"})]},"status")),m.CONDITIONS!==l.CONDITIONS&&a.push(e.jsxs("li",{children:["Condition from"," ",e.jsx("em",{children:m.CONDITIONS||"—"})," ","to"," ",e.jsx("strong",{children:l.CONDITIONS||"—"})]},"conditions")),l.archival_reason&&a.push(e.jsxs("li",{children:["Reason:"," ",e.jsx("strong",{children:l.archival_reason})]},"reason"));else if(t.action==="create")a.push(e.jsx("li",{className:"text-green-600 font-semibold",children:"✅ Asset Created"},"created_flag")),["SYSTEMASSETID","ASSETNO","EMPLOYEENAME","STATUS","CONDITIONS","LOCATIONID","PRODUCTID","DESCRIPTION","MODEL","SERIALNO","ISSUEDTO","DATEISSUUED"].forEach(s=>{l[s]&&a.push(e.jsxs("li",{children:[e.jsxs("strong",{children:[f[s]||s,":"]})," ",l[s]]},s))}),(u=l.COMPONENTS)!=null&&u.length&&a.push(e.jsxs("li",{className:"mt-2 font-medium",children:["Components:",e.jsx("ul",{className:"list-disc ml-6 text-gray-700",children:l.COMPONENTS.map((s,o)=>e.jsxs("li",{children:[s.ASSETCOMPONENTNAME," ",s.DESCRIPTION?`– ${s.DESCRIPTION}`:""]},o))})]},"components"));else if(t.action==="update")a.push(e.jsx("li",{className:"text-blue-600 font-semibold",children:"✏️ Asset Updated"},"updated_flag")),Object.entries(n).forEach(([r,s])=>{const o=(s.from??"").toString().trim(),p=(s.to??"").toString().trim(),y=f[r]||r;o!==p&&a.push(e.jsxs("li",{children:[e.jsxs("strong",{children:[y,":"]})," ",o||"—"," ","→"," ",p||"—"]},r))});else if(t.action==="scanned_qr"){if(a.push(e.jsx("li",{className:"text-indigo-600 font-semibold",children:"📷 QR Code Scanned"},"scanned_flag")),n.scanned_by&&a.push(e.jsxs("li",{children:[e.jsx("strong",{children:"Scanned By:"})," ",n.scanned_by]},"scanned_by")),n.scanned_at){const r=new Date(n.scanned_at).toLocaleString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"numeric",minute:"2-digit",hour12:!0});a.push(e.jsxs("li",{children:[e.jsx("strong",{children:"Scanned At:"})," ",r]},"scanned_at"))}n.system_asset_id&&a.push(e.jsxs("li",{children:[e.jsx("strong",{children:"System Asset ID:"})," ",n.system_asset_id]},"system_asset_id"))}else Object.keys(l).forEach(r=>{const s=(m[r]??"").toString().trim(),o=(l[r]??"").toString().trim(),p=f[r]||r;s!==o&&a.push(e.jsxs("li",{children:[e.jsxs("strong",{children:["Transferred ",p]})," ","from"," ",e.jsx("em",{children:s||"—"})," ","to"," ",e.jsx("strong",{children:o||"—"})]},r))});return e.jsx(_,{children:e.jsx("ul",{className:"text-sm space-y-1 max-w-xs overflow-auto",children:a})})}return c==="created_at"?e.jsx(_,{children:new Date(t.created_at).toLocaleString()}):e.jsx(_,{children:c==="user.name"?((x=t.user)==null?void 0:x.name)||"—":t[c]})}},t.id)})]});return e.jsxs($,{children:[e.jsx(F,{title:"Audit Log"}),e.jsxs("div",{className:"container mx-auto p-4",children:[e.jsx("div",{className:"my-6",children:e.jsx(q,{color:"primary",variant:"flat",as:z,href:g("employees.index"),children:"← Back"})}),e.jsx("h1",{className:"text-2xl font-bold mb-4",children:"Audit Log"}),e.jsx("div",{className:"flex w-full flex-col",children:e.jsxs(H,{"aria-label":"Action tabs",selectedKey:O,onSelectionChange:P,children:[e.jsx(E,{title:"All",children:N()},""),b.map(t=>e.jsx(E,{title:t,children:N()},t))]})})]})]})}export{ge as default};
