import{j as e,K as as,r as o,L as ts,$ as Se,S as O,V as A}from"./app-oLxkKvh7.js";import{A as rs,M as ns}from"./Authenticated-ky3aP7Ra.js";import{u as ls}from"./useDebounce-DQz2wRBA.js";import{C as is}from"./index-IWoAG15N.js";import{G as Oe,s as S}from"./index-jmsbeljX.js";import{F as os}from"./swiper-Bdcdivyb.js";import{t as ve,H as cs}from"./index-7a-lzfqU.js";import{A as ds}from"./AssetComponents-Cd2wZ1kV.js";import{s as hs,n as K}from"./statusConstants-B9bmVMgg.js";import{S as us,a as xs}from"./swiper-react-BRposEoO.js";import{m as Y,a as H,b as B,c as G,d as $,u as w}from"./index-NoG0MibU.js";import{i as ps}from"./chunk-3TCFMHK3-BJ9w7Qvi.js";import{b as d}from"./chunk-KCYYJJH4-BHOCjm0p.js";import{s as y,l as E}from"./chunk-2C6KNKEU-CvQj7kF4.js";import{i as W}from"./chunk-5CAICSBD-CTsQBP1_.js";import{d as _e,a as Ne,b as be,m as V}from"./chunk-Z2IJA2C6-BuIFAIpQ.js";import{b as ms}from"./chunk-57V4RE7B-8GEVwbgL.js";import{t as fs,a as js,b as v,c as gs,d as Ss,e as _}from"./chunk-F3UDT23P-D23ud7JH.js";import{c as vs}from"./chunk-J7I6W5JF-BO70uQar.js";import"./index-0-18Hqup.js";import"./useDialog-BLiS4Nas.js";import"./index-CHntfa28.js";import"./chunk-SLABUSGS-Cgf3kNWO.js";import"./index-Cv7EaI-L.js";import"./useListState-B7bB-yV1.js";import"./useMenuTriggerState-DKOKE8rg.js";import"./LiveAnnouncer-DIMlPII3.js";const _s=({isOpen:u,selectedAsset:r,onOpenChange:j,onComponentModalOpen:f})=>{var x;const h=(x=r==null?void 0:r.asset_details)==null?void 0:x[0],i=h==null?void 0:h.latest_scan;return e.jsx(Y,{isOpen:u,size:"xl",placement:"top-center",onOpenChange:j,children:e.jsx(H,{children:N=>{var g,p,m,c,l,n,b;return e.jsxs(e.Fragment,{children:[e.jsx(B,{className:"flex flex-col gap-1",children:"Assets Details"}),e.jsx(G,{children:r&&e.jsxs("div",{className:"flex flex-wrap gap-6",children:[e.jsx(us,{spaceBetween:10,slidesPerView:1,className:"w-full sm:w-1/2 lg:w-1/3",children:((g=r==null?void 0:r.asset_details[0])==null?void 0:g.IMAGEPATH)&&JSON.parse(r.asset_details[0].IMAGEPATH).map((t,C)=>e.jsx(xs,{children:e.jsx(ps,{src:`/storage/${t}`,alt:`Asset Image ${C+1}`,className:"object-cover",width:400,height:200,onError:I=>I.target.src="/assets/placeholder.jpg"})},C))}),e.jsxs("div",{className:"flex-1 space-y-4 text-sm text-gray-700",children:[e.jsxs("p",{children:[e.jsx("span",{className:"font-semibold",children:"Description:"})," ",(p=r.asset_details[0])==null?void 0:p.DESCRIPTION]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-semibold",children:"Serial Number:"})," ",(m=r.asset_details[0])==null?void 0:m.SERIALNO]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-semibold",children:"Date Issued:"})," ",(l=(c=r.asset_details[0])==null?void 0:c.DATEISSUUED)==null?void 0:l.trim()]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-semibold",children:"Condition:"})," ",(n=r.asset_details[0])==null?void 0:n.CONDITIONS]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-semibold",children:"Last Audit:"})," ",(b=i==null?void 0:i.changes)!=null&&b.scanned_at?new Date(i.changes.scanned_at).toLocaleString():"--"]}),e.jsx(d,{color:"primary",variant:"light",onPress:f,children:"View components"})]})]})}),e.jsx($,{children:e.jsx(d,{color:"danger",variant:"flat",onPress:N,children:"Close"})})]})}})})},Ns=({isTransferOpen:u,onTransferOpenChange:r,employees:j,location:f,selectedEmployeeId:h,setSelectedEmployeeId:i,selectedLocationId:x,setSelectedLocationId:N,statusToTransfer:g,setStatusToTransfer:p,newStatus:m,selectedKeys:c,handleTransferAssets:l,loading:n})=>e.jsx(Y,{isOpen:u,onOpenChange:r,children:e.jsx(H,{children:b=>e.jsxs(e.Fragment,{children:[e.jsxs(B,{className:"flex flex-col gap-1",children:[e.jsx("h1",{className:"text-lg font-semibold",children:"Transfer Assets"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Select a location, employee and status to transfer the selected assets."})]}),e.jsxs(G,{children:[e.jsx(y,{label:"Select Employee",value:h,onChange:t=>i(t.target.value),children:j.map((t,C)=>t.EMPLOYEEID?e.jsx(E,{value:t.EMPLOYEEID,children:t.EMPLOYEENAME},t.EMPLOYEEID):null)}),e.jsx(y,{label:"Select Location",value:x,onChange:t=>N(t.target.value),children:f.map(t=>e.jsx(E,{value:t.LOCATIONID,children:t.LOCATIONNAME},t.LOCATIONID))}),e.jsx(y,{label:"Select Status",value:g,onChange:t=>p(t.target.value),children:m.map(t=>e.jsx(E,{value:t.value,children:t.label},t.value))})]}),e.jsxs($,{children:[e.jsx(d,{color:"danger",variant:"light",onPress:b,children:"Cancel"}),e.jsx(d,{color:"primary",onPress:()=>{l(Array.from(c),x,h),b()},isDisabled:!x||!h,isLoading:n,children:n?"Transferring...":"Transfer"})]})]})})}),bs=({isArchiveOpen:u,onArchiveOpenChange:r,statusToArchive:j,setStatusToArchive:f,reason:h,setReason:i,condition:x,setCondition:N,handleArchiveAssets:g,selectedAsset:p,archiveLoading:m,newStatus:c})=>e.jsx(Y,{isOpen:u,onOpenChange:r,placement:"top-center",children:e.jsx(H,{children:l=>e.jsxs(e.Fragment,{children:[e.jsxs(B,{className:"flex flex-col gap-1",children:[e.jsx("h1",{className:"text-lg font-semibold text-danger-500",children:"Are you sure you want to dispose?"}),e.jsxs(G,{className:"",children:[e.jsx(ve,{isRequired:!0,label:"Reason for disposal",value:h,onChange:n=>i(n.target.value)}),e.jsx(y,{isRequired:!0,variant:"faded",label:"Select Status",value:j,onChange:n=>f(n.target.value),children:c.map(n=>e.jsx(E,{value:n.value,children:n.label},n.value))}),e.jsx(ve,{variant:"faded",isRequired:!0,label:"Asset Condition",value:x,onChange:n=>N(n.target.value)})]})]}),e.jsxs($,{children:[e.jsx(d,{color:"danger",variant:"light",onPress:l,children:"Cancel"}),e.jsx(d,{color:"primary",onPress:()=>{g(p.asset_details.map(n=>n.ASSETNO)),l()},isDisabled:!h||!x,isLoading:m,children:m?"Disposing...":"Dispose"})]})]})})}),Os=({location:u,selectedLocationId:r,setSelectedLocationId:j,statusToTransfer:f,setStatusToTransfer:h,newStatus:i,selectedKeys:x,isDeclassificationOpen:N,onDeclassificationOpenChange:g,handleDeclassification:p,loading:m})=>e.jsx(Y,{isOpen:N,onOpenChange:g,children:e.jsx(H,{children:c=>e.jsxs(e.Fragment,{children:[e.jsxs(B,{className:"flex flex-col gap-1",children:[e.jsx("h1",{className:"text-lg font-semibold",children:"Declassify Assets"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Select a location and status to declassify the selected assets."})]}),e.jsxs(G,{children:[e.jsx(y,{label:"Select Location",value:r,onChange:l=>j(l.target.value),children:u.map(l=>e.jsx(E,{value:l.LOCATIONID,children:l.LOCATIONNAME},l.LOCATIONID))}),e.jsx(y,{label:"Select Status",value:f,onChange:l=>h(l.target.value),children:i.map(l=>e.jsx(E,{value:l.value,children:l.label},l.value))})]}),e.jsxs($,{children:[e.jsx(d,{color:"danger",variant:"light",onPress:c,children:"Cancel"}),e.jsx(d,{color:"primary",onPress:()=>{p(Array.from(x),r),c()},isDisabled:!r||!f,isLoading:m,children:m?"Declassifying...":"Declassify"})]})]})})});function Cs(u){return Oe({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polyline",attr:{points:"15 14 20 9 15 4"},child:[]},{tag:"path",attr:{d:"M4 20v-7a4 4 0 0 1 4-4h12"},child:[]}]})(u)}function Ds(u){return Oe({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"line",attr:{x1:"12",y1:"5",x2:"12",y2:"19"},child:[]},{tag:"line",attr:{x1:"5",y1:"12",x2:"19",y2:"12"},child:[]}]})(u)}function ta(){const{employees:u,assets:r,location:j,title:f,desc:h,filters:i={},descriptions:x,statuses:N,issuedTos:g}=as().props,[p,m]=o.useState(i.search||""),[c,l]=o.useState(i.sort||""),[n,b]=o.useState(i.start_date||""),[t,C]=o.useState(i.end_date||""),[I,Ce]=o.useState(i.description||""),[J,De]=o.useState(i.status||""),[Q,Ae]=o.useState(i.issued_to||""),[ye,As]=o.useState(i.sort_field||""),[Ee,ys]=o.useState(i.sort_direction||""),{isOpen:Te,onOpen:we,onOpenChange:Ie}=w(),[q,X]=o.useState(null),[T,L]=o.useState(new Set),[M,P]=o.useState(""),F=(a,s)=>{O.get(S("assets.index"),{search:p,sort:c,start_date:a,end_date:s},{preserveState:!0,replace:!0})},Le=a=>{const s=a.target.value;b(s),F(s,t)},Me=a=>{const s=a.target.value;C(s),F(n,s)},Pe=ls(a=>{O.get(S("assets.index"),{search:a,sort:c},{preserveState:!0,replace:!0})},300),Fe=a=>{const s=a.target.value;m(s),Pe(s)},Re=()=>{m(""),O.get(S("assets.index"),{search:"",sort:c})},ke=()=>{const a=c==="name_asc"?"name_desc":"name_asc";l(a),O.get(S("assets.index"),{search:p,sort:a},{preserveState:!0,replace:!0})},ze=a=>{O.get(S("assets.index"),{search:p,sortField:ye,sortDirection:Ee,start_date:n,end_date:t,description:I,status:J,issued_to:Q,...a},{preserveState:!0,replace:!0})},{isOpen:Ue,onOpen:Ve,onOpenChange:Ye}=w(),{isOpen:He,onOpen:Be,onOpenChange:Ge}=w(),[Z,R]=o.useState(""),[ee,k]=o.useState(!1),[$e,se]=o.useState(""),qe=(a,s,z)=>{const D=a.map(Number);k(!0),O.post(S("assetsextended.transfer"),{asset_nos:D,location_id:s,employee_id:z,status:M},{preserveState:!0,replace:!0,onSuccess:()=>{L(new Set),R(""),se(""),P(""),A.success("Assets transferred successfully.")},onError:U=>{console.error("Transfer failed:",U),A.error("Failed to transfer assets.")},onFinish:()=>{k(!1)}})},Ke=(a,s)=>{const z=a.map(Number);k(!0),O.post(S("assetsextended.declassify"),{asset_nos:z,location_id:s,status:M},{preserveState:!0,replace:!0,onSuccess:()=>{L(new Set),R(""),P(""),A.success("Assets transferred successfully.")},onError:D=>{console.error("Transfer failed:",D),A.error("Failed to transfer assets.")},onFinish:()=>{k(!1)}})},{isOpen:We,onOpen:Je,onOpenChange:Qe}=w(),[ae,te]=o.useState(""),[re,ne]=o.useState(""),[le,ie]=o.useState(!1),[oe,ce]=o.useState(""),Xe=a=>{ie(!0),O.post(S("assetsextended.archive",{assetNo:a}),{status:oe,archival_reason:ae,conditions:re},{preserveState:!0,replace:!0,onSuccess:()=>{L(new Set),ce(""),te(""),ne(""),A.success("Assets archived successfully.")},onError:s=>{console.error("Archive failed:",s),A.error("Failed to archive assets.")},onFinish:()=>{ie(!1)}})},{isOpen:Ze,onOpen:es,onOpenChange:ss}=w();return e.jsxs(rs,{children:[e.jsx(ts,{title:f}),e.jsxs("div",{className:"p-6",children:[e.jsx("h1",{className:"text-2xl font-bold mb-4",children:f}),e.jsx("p",{className:"text-gray-600 mb-4",children:h}),e.jsxs("div",{className:"flex justify-between mb-4",children:[e.jsx(W,{isClearable:!0,className:"w-full sm:max-w-[44%]",placeholder:"Search by name, description...",startContent:e.jsx(is,{className:"size-5"}),value:p,onClear:Re,onChange:Fe}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(os,{statuses:N,status:J,setStatus:De,descriptions:x,description:I,setDescription:Ce,issuedTos:g,issuedTo:Q,applyFilters:ze,setIssuedTo:Ae}),e.jsxs(_e,{children:[e.jsx(Ne,{children:e.jsx(d,{variant:"bordered",children:"Filter by Date Issued"})}),e.jsx(be,{"aria-label":"Filter by Date Issued",className:"p-2 w-72",closeOnSelect:!1,children:e.jsx(V,{className:"cursor-default",children:e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsx(W,{type:"date",label:"Start Date",value:n,onChange:Le}),e.jsx(W,{type:"date",label:"End Date",value:t,onChange:Me}),e.jsxs("div",{className:"flex justify-end gap-2 mt-2",children:[e.jsx(d,{color:"primary",onPress:()=>F(n,t),children:"Apply"}),e.jsx(d,{color:"warning",variant:"flat",onPress:()=>{b(""),C(""),F("","")},children:"Clear"})]})]})},"filter")})]})]})]}),e.jsxs("div",{className:"flex w-full flex-col",children:[e.jsx("div",{className:"flex justify-start items-center mb-4 gap-2",children:e.jsxs(ms,{children:[e.jsx(d,{color:"primary",as:Se,variant:"flat",startContent:e.jsx(Ds,{className:"size-5"}),href:S("assetsextended.create"),children:"Add Asset"}),e.jsx(d,{color:"success",variant:"flat",startContent:e.jsx(Cs,{className:"size-5"}),onPress:Ve,isDisabled:T.size===0,children:"Transfer Asset"}),e.jsx(d,{color:"secondary",variant:"flat",startContent:e.jsx(ns,{className:"size-5"}),onPress:Be,isDisabled:T.size===0,children:"Declassification"})]})}),e.jsxs(fs,{isCompact:!0,isHeaderSticky:!0,isVirtualized:!0,maxTableHeight:"calc(100vh - 300px)",selectionMode:"multiple",selectedKeys:T,onSelectionChange:L,"aria-label":"Employee Assets table",isStriped:!0,children:[e.jsxs(js,{className:"sticky top-0 bg-white z-10",children:[e.jsx(v,{children:"Asset #"}),e.jsx(v,{children:"System Asset ID"}),e.jsx(v,{children:"Description"}),e.jsx(v,{children:"Model"}),e.jsx(v,{children:"Serial No"}),e.jsxs(v,{onClick:ke,style:{cursor:"pointer"},children:["EMPLOYEE",c==="name_asc"&&" 🔼",c==="name_desc"&&" 🔽",!["name_asc","name_desc"].includes(c)&&" ⏺️"]}),e.jsx(v,{children:"Location"}),e.jsx(v,{children:"Status"}),e.jsx(v,{children:"Last Audit"}),e.jsx(v,{children:"Actions"})]}),e.jsx(gs,{emptyContent:"No rows to display.",children:r.filter(a=>a.asset_details.some(s=>parseInt(s.archived)===0)).map(a=>a.asset_details.filter(s=>parseInt(s.archived)===0).map((s,z)=>{var D,U,de,he,ue,xe,pe,me,fe,je,ge;return e.jsxs(Ss,{children:[e.jsx(_,{children:(D=s.ASSETNUMBER)==null?void 0:D.trim()}),e.jsx(_,{children:(U=s.SYSTEMASSETID)==null?void 0:U.trim()}),e.jsx(_,{children:(de=s.DESCRIPTION)==null?void 0:de.trim()}),e.jsx(_,{children:(he=s.MODEL)==null?void 0:he.trim()}),e.jsx(_,{children:(ue=s.SERIALNO)==null?void 0:ue.trim()}),e.jsx(_,{children:(xe=a.EMPLOYEENAME)==null?void 0:xe.trim()}),e.jsx(_,{children:(pe=s==null?void 0:s.location.LOCATIONNAME)==null?void 0:pe.trim()}),e.jsx(_,{children:e.jsx(vs,{variant:"flat",color:hs[(me=s.STATUS)==null?void 0:me.trim()]||"default",radius:"md",children:(fe=s.STATUS)==null?void 0:fe.trim()})}),e.jsx(_,{children:(ge=(je=s.latest_scan)==null?void 0:je.changes)!=null&&ge.scanned_at?new Date(s.latest_scan.changes.scanned_at).toLocaleDateString():"--"}),e.jsx(_,{children:e.jsxs(_e,{children:[e.jsx(Ne,{children:e.jsx(d,{isIconOnly:!0,size:"sm",variant:"light",children:e.jsx(cs,{size:20,className:"text-default-800"})})}),e.jsxs(be,{children:[e.jsx(V,{onPress:()=>{X({...a,asset_details:[s]}),we()},children:"View"},"view"),e.jsx(V,{as:Se,href:S("assetsextended.edit",s.ASSETNO),children:"Update"},"update"),e.jsx(V,{className:"text-danger",color:"danger",onPress:()=>{X({...a,asset_details:[s]}),Je()},children:"Dispose"},"dispose")]})]})})]},s.ASSETNO)}))})]})]}),e.jsx(_s,{selectedAsset:q,isOpen:Te,onOpenChange:Ie,onComponentModalOpen:es}),e.jsx(ds,{onComponentModalOpenChange:ss,selectedAsset:q,isComponentModalOpen:Ze}),e.jsx(Ns,{isTransferOpen:Ue,onTransferOpenChange:Ye,employees:u,location:j,selectedEmployeeId:$e,setSelectedEmployeeId:se,selectedLocationId:Z,setSelectedLocationId:R,statusToTransfer:M,setStatusToTransfer:P,newStatus:K,selectedKeys:T,handleTransferAssets:qe,loading:ee}),e.jsx(Os,{location:j,selectedLocationId:Z,setSelectedLocationId:R,statusToTransfer:M,setStatusToTransfer:P,newStatus:K,selectedKeys:T,isDeclassificationOpen:He,onDeclassificationOpenChange:Ge,handleDeclassification:Ke,loading:ee}),e.jsx(bs,{isArchiveOpen:We,onArchiveOpenChange:Qe,reason:ae,setReason:te,statusToArchive:oe,setStatusToArchive:ce,condition:re,setCondition:ne,handleArchiveAssets:Xe,loading:le,selectedAsset:q,archiveLoading:le,newStatus:K})]})]})}export{ta as default};
