import{K as Ie,r as d,m as Te,j as e,L as ue,$ as Ce,V as N,S as z}from"./app-DcA1Ya5n.js";import{A as he}from"./Authenticated-CLbR4XAu.js";import{s as x}from"./index-DYc8GT79.js";import{a as xe,c as ge}from"./statusConstants-B9bmVMgg.js";import{A as B}from"./index-BouUfmTa.js";import{u as G,m as W,a as J,b as V,c as Z,d as k}from"./index-fVNV7TtF.js";import{b as c}from"./chunk-KCYYJJH4-BJsl7Des.js";import{F as De}from"./chunk-LAX3QLKM-d4I4Tf9v.js";import{i as m}from"./chunk-5CAICSBD-DejQdHXG.js";import{a as Ae}from"./chunk-DNIGSRME-CpIjOjeS.js";import{l as E,s as C}from"./chunk-2C6KNKEU-CnYGuXrP.js";import{i as q}from"./chunk-3TCFMHK3-DIBZUgNY.js";import{t as je,a as fe,b as I,c as Pe,d as Me,e as T}from"./chunk-F3UDT23P-CZ-s9wDQ.js";import"./index-0-18Hqup.js";import"./useDialog-BCMhdX0G.js";import"./index-gG7cdACS.js";import"./chunk-SLABUSGS-DvehVeir.js";import"./index-BSEFKlKf.js";import"./useFilter-CEXbgNzS.js";import"./useSingleSelectListState-BuAWNjvA.js";import"./useListState-AELfYMcB.js";import"./LiveAnnouncer-DM9XYwof.js";import"./useMenuTriggerState-xe7R_jTd.js";function es(){var Y;const{assetDetail:n={},assetcomponents:g=[],products:D=[],locations:Q=[],employees:h={},title:A,description:X}=Ie().props,[j,f]=d.useState(!1),{isOpen:ee,onOpen:se,onOpenChange:te}=G(),{isOpen:ne,onOpen:ae,onOpenChange:le}=G(),[oe,ve]=d.useState([]),[u,P]=d.useState([...n.component_details||[]]),[O,M]=d.useState(""),[v,b]=d.useState(""),{data:a,setData:r,processing:re,reset:ie}=Te({EMPLOYEEID:n.EMPLOYEEID||"",ASSETID:n.ASSETID||"",ASSETNO:n.ASSETNO||"",PRODUCTID:n.PRODUCTID||"",DESCRIPTION:n.DESCRIPTION||"",MODEL:n.MODEL||"",SERIALNO:n.SERIALNO||"",ISSUEDTO:n.ISSUEDTO||"",DATEISSUUED:n.DATEISSUUED||"",IMAGEPATH:"",STATUS:n.STATUS||"",CONDITIONS:n.CONDITIONS||"",WORKSTATION:n.WORKSTATION||"",TYPESIZE:n.TYPESIZE||"",NOPRINT:n.NOPRINT||"",COMPONENT:n.COMPONENT||"",WITHCOMPONENTS:n.WITHCOMPONENTS||!1,SYSTEMASSETID:n.SYSTEMASSETID||"",SYSTEMCOMPONENTID:"",LOCATIONID:n.LOCATIONID||""}),ce=((Y=h==null?void 0:h.EMPLOYEENAME)==null?void 0:Y.trim())||"",y=s=>{var K,F,$,H;const t=s.target.value,l=D.find(Ee=>String(Ee.PRODUCTID)===String(t));r("PRODUCTID",t),r("DESCRIPTION",((K=l==null?void 0:l.DESCRIPTION)==null?void 0:K.trim())||"");const o=(($=(F=n==null?void 0:n.asset)==null?void 0:F.employee)==null?void 0:$.EMPLOYEEID)||a.EMPLOYEEID,S=(H=l==null?void 0:l.asset_component)==null?void 0:H.ASSETCOMPNETID,Ne=[o,t,S||null,n.ASSETNUMBER].filter(Boolean).join("-");r("SYSTEMASSETID",Ne)},de=()=>{if(!O){N.error("Please select a component.");return}const s=g.find(i=>String(i.ASSETCOMPNETID)===String(O)),o=[...u].filter(i=>String(i.ASSETCOMPNETID)===String(O)).length+1,S={ASSETCOMPNETID:O,COMPONENTNUMBER:o,COMPONENTDESCRIPTION:v,SYSTEMCOMPONENTID:`${a.EMPLOYEEID}-${a.PRODUCTID}-${O}-${o}`,asset_component:s};P(i=>[...i,S]),b(""),M(""),N.success("Component added.")},me=s=>{P(t=>t.filter((l,o)=>o!==s))},Se=async s=>{s.preventDefault(),f(!0);try{z.post(x("assetsextended.update",n.ASSETNO),{...a,COMPONENT:u,WITHCOMPONENTS:oe.length>0,existing_images:JSON.stringify(p),new_images:R,_method:"PUT"},{forceFormData:!0,preserveScroll:!0,onSuccess:()=>{N.success("Asset updated successfully!"),z.visit(x("assets.index"))},onError:()=>N.error("Failed to update asset.")})}catch{N.error("Unexpected error occurred.")}finally{f(!1)}},[_,U]=d.useState([]),[R,L]=d.useState([]),[p,Oe]=d.useState(()=>{try{return Array.isArray(n.IMAGEPATH)?n.IMAGEPATH:n.IMAGEPATH?JSON.parse(n.IMAGEPATH):[]}catch{return[]}}),pe=s=>{const t=Array.from(s.target.files);L(t);const l=t.map(o=>URL.createObjectURL(o));U(l)},w=s=>{const t=R.filter((S,i)=>i!==s),l=_.filter((S,i)=>i!==s),o=p.filter((S,i)=>i!==s);s<p.length?Oe(o):(s-p.length,L(t),U(l))};return e.jsxs(he,{children:[e.jsx(ue,{title:A}),e.jsxs("div",{className:"p-6",children:[e.jsx(c,{as:Ce,href:x("assets.index"),variant:"flat",color:"primary",children:"← Back"}),e.jsx("h2",{className:"text-xl font-bold mt-4",children:A}),e.jsx("p",{className:"text-gray-600 mb-4",children:X}),e.jsxs(De,{onSubmit:Se,className:"w-full mx-auto space-y-4",children:[e.jsxs("div",{className:"flex w-full gap-4",children:[e.jsx(m,{label:"Employee Name",value:ce,isReadOnly:!0}),e.jsx(Ae,{label:"Select Product",selectedKey:a.PRODUCTID??null,onSelectionChange:s=>{r("PRODUCTID",s),y({target:{value:s}})},onChange:y,children:D.map(s=>e.jsx(E,{value:s.PRODUCTID,children:s.DESCRIPTION},s.PRODUCTID))})]}),e.jsxs("div",{className:"w-full flex gap-4",children:[e.jsx(m,{className:"w-1/2",label:"Description",value:a.DESCRIPTION,readOnly:!0}),e.jsxs(c,{color:"success",variant:"flat",onPress:se,children:["(",u.length,") Components"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(m,{label:"Model",value:a.MODEL,onChange:s=>r("MODEL",s.target.value)}),e.jsx(m,{label:"Serial No.",value:a.SERIALNO,onChange:s=>r("SERIALNO",s.target.value)}),e.jsx(m,{label:"System Asset ID",value:a.SYSTEMASSETID,isReadOnly:!0})]}),e.jsxs("div",{className:"w-full flex gap-4",children:[e.jsx(C,{label:"Status",selectedKeys:a.STATUS?[a.STATUS.trim()]:[],onSelectionChange:s=>r("STATUS",Array.from(s)[0]),children:xe.map(s=>e.jsx(E,{value:s.value,children:s.label},s.value))}),e.jsx(C,{label:"Condition",selectedKeys:a.CONDITIONS?[a.CONDITIONS.trim()]:[],onSelectionChange:s=>r("CONDITIONS",Array.from(s)[0]),value:a.CONDITIONS,onChange:s=>r("CONDITIONS",s.target.value),children:ge.map(s=>e.jsx(E,{value:s.value,children:s.label},s.value))})]}),e.jsxs("div",{className:"w-full flex gap-4",children:[e.jsx(m,{type:"date",label:"Date Issued",value:a.DATEISSUUED?new Date(a.DATEISSUUED.trim()).toISOString().split("T")[0]:"",onChange:s=>r("DATEISSUUED",s.target.value)}),e.jsx(C,{label:"Location",selectedKeys:[a.LOCATIONID],onSelectionChange:s=>r("LOCATIONID",s.currentKey),onChange:s=>r("LOCATIONID",s.target.value),children:Q.map(s=>e.jsx(E,{value:s.LOCATIONID,children:s.LOCATIONNAME},s.LOCATIONID))})]}),e.jsxs("div",{className:"flex gap-4 flex-wrap mb-2",children:[p.map((s,t)=>e.jsxs("div",{className:"relative",children:[e.jsx(q,{src:`/storage/${s}`,alt:`Asset Image ${t+1}`,className:"w-32 h-32 object-cover rounded border"}),e.jsx(c,{color:"danger",variant:"light",className:"z-50 absolute top-0 right-0",onPress:()=>w(t),isIconOnly:!0,children:e.jsx(B,{className:"size-4"})})]},t)),_.map((s,t)=>e.jsxs("div",{className:"relative",children:[e.jsx(q,{src:s,alt:`New Image Preview ${t+1}`,className:"w-32 h-32 object-cover rounded border"}),e.jsx(c,{color:"danger",variant:"light",isIconOnly:!0,className:"z-50 absolute top-0 right-0",onPress:()=>w(t),children:e.jsx(B,{className:"size-4"})})]},t)),e.jsx(m,{type:"file",multiple:!0,accept:"image/*",onChange:pe})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(c,{color:"primary",type:"submit",isLoading:j,isDisabled:re,children:j?"Saving...":"Update Asset"}),e.jsx(c,{type:"button",variant:"flat",color:"warning",onPress:ie,children:"Reset"})]})]})]}),e.jsx(W,{size:"3xl",isOpen:ee,onOpenChange:te,children:e.jsx(J,{children:s=>e.jsxs(e.Fragment,{children:[e.jsx(V,{children:"Components"}),e.jsx(Z,{children:e.jsxs(je,{"aria-label":"Component Table",topContent:e.jsx(c,{color:"primary",onPress:ae,children:"Add New Component"}),children:[e.jsxs(fe,{children:[e.jsx(I,{children:"COMPONENTNUMBER"}),e.jsx(I,{children:"COMPONENTNAME"}),e.jsx(I,{children:"DESCRIPTION"}),e.jsx(I,{children:"SYSTEMCOMPONENTID"}),e.jsx(I,{children:"Actions"})]}),e.jsx(Pe,{emptyContent:"No components yet.",children:u.map((t,l)=>{var o;return e.jsxs(Me,{children:[e.jsx(T,{children:t.COMPONENTNUMBER}),e.jsx(T,{children:((o=t.asset_component)==null?void 0:o.ASSETCOMPONENTNAME)||"—"}),e.jsx(T,{children:t.COMPONENTDESCRIPTION}),e.jsx(T,{children:t.SYSTEMCOMPONENTID}),e.jsx(T,{children:e.jsx(c,{size:"sm",color:"danger",variant:"light",onPress:()=>me(l),children:"Remove"})})]},l)})})]})}),e.jsx(k,{children:e.jsx(c,{color:"danger",variant:"light",onPress:s,children:"Close"})})]})})}),e.jsx(W,{size:"xl",isOpen:ne,onOpenChange:le,children:e.jsx(J,{children:s=>e.jsxs(e.Fragment,{children:[e.jsx(V,{children:"Add Component"}),e.jsxs(Z,{children:[e.jsx(C,{label:"Select Component",selectedKeys:[O],onSelectionChange:t=>M(t.currentKey),children:g.map(t=>e.jsx(E,{value:t.ASSETCOMPNETID,children:t.ASSETCOMPONENTNAME},t.ASSETCOMPNETID))}),e.jsx(m,{label:"Component Description",value:v,onChange:t=>b(t.target.value)}),e.jsx(c,{color:"primary",onPress:de,children:"Add"})]}),e.jsx(k,{children:e.jsx(c,{color:"danger",variant:"light",onPress:s,children:"Close"})})]})})})]})}export{es as default};
