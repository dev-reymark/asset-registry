import{K as rs,r as a,j as e,L as ns,$ as je,S as j,V as v}from"./app-B0X8LBby.js";import{A as ls}from"./Authenticated--06jBr2V.js";import{u as is}from"./useDebounce-DsUGvIyJ.js";import{C as os}from"./index-BEYtlNV7.js";import{s as h}from"./index-Z17vvjSM.js";import{F as cs}from"./swiper-Pg41lggC.js";import{S as ds,a as hs}from"./swiper-react-DpaxEkDc.js";import{H as Se,t as fe}from"./index-BhvpWkQK.js";import{A as ms}from"./AssetComponents-hb5dmUA1.js";import{s as ge,n as ve}from"./statusConstants-B9bmVMgg.js";import{t as xs,a as _e}from"./chunk-ML27DD5T-CzmepFGm.js";import{u as I,m as U,a as z,b as Y,c as V,d as H}from"./index-DL-AlCfS.js";import{i as k}from"./chunk-5CAICSBD-BAviX038.js";import{d as $,a as q,b as K,m as _}from"./chunk-Z2IJA2C6-CsnLqhDc.js";import{b as l}from"./chunk-KCYYJJH4-B9QN_wGJ.js";import{t as Ee,a as Ae,b as r,c as Ne,d as be,e as n}from"./chunk-F3UDT23P-EQ_dTb7a.js";import{c as Oe}from"./chunk-J7I6W5JF-CvasT7CT.js";import{i as us}from"./chunk-3TCFMHK3-DVcfhQ7F.js";import{s as y,l as w}from"./chunk-2C6KNKEU-C9aYhCVC.js";import"./index-0-18Hqup.js";import"./useDialog-BsVDVOBe.js";import"./index-BXRWZj2O.js";import"./chunk-SLABUSGS-Bl7IaLmR.js";import"./index-BNwUC09x.js";import"./index-CokAva9Y.js";import"./features-max-BoktI70t.js";import"./features-animation-DQcXFvtm.js";import"./useSingleSelectListState-DGVtJ0EF.js";import"./useListState-ktyrr1GA.js";import"./useMenuTriggerState-CtS7Iklo.js";import"./LiveAnnouncer-CDBqPD6z.js";function Js(){const{employees:B,assets:L,location:G,title:De,desc:Ce,filters:m={},descriptions:Te,statuses:Ie,issuedTos:ye}=rs().props;console.log("employees",B),console.log("assets",L),console.log("location",G);const[A,J]=a.useState(m.search||""),[i,we]=a.useState(m.sort||""),[N,Q]=a.useState(m.start_date||""),[b,W]=a.useState(m.end_date||""),[X,Le]=a.useState(m.description||""),[Z,Me]=a.useState(m.status||""),[ee,Pe]=a.useState(m.issued_to||""),[Fe,ps]=a.useState(m.sort_field||""),[Re,js]=a.useState(m.sort_direction||""),{isOpen:Ue,onOpen:se,onOpenChange:ze}=I(),[o,O]=a.useState(null),[D,C]=a.useState(new Set),[te,ae]=a.useState(""),T=(t,s)=>{j.get(h("assets.index"),{search:A,sort:i,start_date:t,end_date:s},{preserveState:!0,replace:!0})},Ye=t=>{const s=t.target.value;Q(s),T(s,b)},Ve=t=>{const s=t.target.value;W(s),T(N,s)},He=is(t=>{j.get(h("assets.index"),{search:t,sort:i},{preserveState:!0,replace:!0})},300),ke=t=>{const s=t.target.value;J(s),He(s)},$e=()=>{J(""),j.get(h("assets.index"),{search:"",sort:i})},re=()=>{const t=i==="name_asc"?"name_desc":"name_asc";we(t),j.get(h("assets.index"),{search:A,sort:t},{preserveState:!0,replace:!0})},qe=t=>{j.get(h("assets.index"),{search:A,sortField:Fe,sortDirection:Re,start_date:N,end_date:b,description:X,status:Z,issued_to:ee,...t},{preserveState:!0,replace:!0})},{isOpen:Ke,onOpen:Be,onOpenChange:Ge}=I(),[M,ne]=a.useState(""),[le,ie]=a.useState(!1),[P,oe]=a.useState(""),Je=(t,s,S)=>{const c=t.map(Number);ie(!0),j.post(h("assetsextended.transfer"),{asset_nos:c,location_id:s,employee_id:S,status:te},{preserveState:!0,replace:!0,onSuccess:()=>{C(new Set),ne(""),oe(""),ae(""),v.success("Assets transferred successfully.")},onError:d=>{console.error("Transfer failed:",d),v.error("Failed to transfer assets.")},onFinish:()=>{ie(!1)}})},{isOpen:Qe,onOpen:We,onOpenChange:Xe}=I(),[F,ce]=a.useState(""),[R,de]=a.useState(""),[he,me]=a.useState(!1),[xe,ue]=a.useState(""),Ze=t=>{me(!0),j.post(h("assetsextended.archive",{assetNo:t}),{status:xe,archival_reason:F,conditions:R},{preserveState:!0,replace:!0,onSuccess:()=>{C(new Set),ue(""),ce(""),de(""),v.success("Assets archived successfully.")},onError:s=>{console.error("Archive failed:",s),v.error("Failed to archive assets.")},onFinish:()=>{me(!1)}})},es=t=>{j.post(h("assetsextended.restore",{assetNo:t}),{},{preserveState:!0,replace:!0,onSuccess:()=>{v.success("Asset restored successfully.")},onError:s=>{console.error("Restore failed:",s),v.error("Failed to restore asset.")}})},{isOpen:ss,onOpen:ts,onOpenChange:as}=I();return e.jsxs(ls,{children:[e.jsx(ns,{title:"Employee Assets"}),e.jsxs("div",{className:"p-6",children:[e.jsx("h1",{className:"text-2xl font-bold mb-4",children:De}),e.jsx("p",{className:"text-gray-600 mb-4",children:Ce}),e.jsxs("div",{className:"flex justify-between mb-4",children:[e.jsx(k,{isClearable:!0,className:"w-full sm:max-w-[44%]",placeholder:"Search by name, description...",startContent:e.jsx(os,{className:"size-5"}),value:A,onClear:$e,onChange:ke}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(cs,{statuses:Ie,status:Z,setStatus:Me,descriptions:Te,description:X,setDescription:Le,issuedTos:ye,issuedTo:ee,applyFilters:qe,setIssuedTo:Pe}),e.jsxs($,{children:[e.jsx(q,{children:e.jsx(l,{variant:"bordered",children:"Filter by Date Issued"})}),e.jsx(K,{"aria-label":"Filter by Date Issued",className:"p-2 w-72",closeOnSelect:!1,children:e.jsx(_,{className:"cursor-default",children:e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsx(k,{type:"date",label:"Start Date",value:N,onChange:Ye}),e.jsx(k,{type:"date",label:"End Date",value:b,onChange:Ve}),e.jsxs("div",{className:"flex justify-end gap-2 mt-2",children:[e.jsx(l,{color:"primary",onPress:()=>T(N,b),children:"Apply"}),e.jsx(l,{color:"warning",variant:"flat",onPress:()=>{Q(""),W(""),T("","")},children:"Clear"})]})]})},"filter")})]})]})]}),e.jsx("div",{className:"flex w-full flex-col",children:e.jsxs(xs,{"aria-label":"Options",children:[e.jsx(_e,{title:"Active Assets",children:e.jsxs(Ee,{isCompact:!0,isHeaderSticky:!0,isVirtualized:!0,maxTableHeight:"calc(100vh - 300px)",selectionMode:"multiple",selectedKeys:D,onSelectionChange:C,"aria-label":"Employee Assets table",isStriped:!0,topContent:e.jsxs("div",{className:"flex justify-start items-center mb-4 gap-2",children:[e.jsx(l,{color:"primary",as:je,href:h("assetsextended.create"),children:"Add New Asset"}),e.jsx(l,{color:"success",variant:"flat",onPress:Be,isDisabled:D.size===0,children:"Transfer Asset"})]}),children:[e.jsxs(Ae,{className:"sticky top-0 bg-white z-10",children:[e.jsx(r,{children:"Asset #"}),e.jsx(r,{children:"System Asset ID"}),e.jsx(r,{children:"Description"}),e.jsx(r,{children:"Model"}),e.jsx(r,{children:"Serial No"}),e.jsxs(r,{onClick:re,style:{cursor:"pointer"},children:["EMPLOYEE",i==="name_asc"&&" 🔼",i==="name_desc"&&" 🔽",!["name_asc","name_desc"].includes(i)&&" ⏺️"]}),e.jsx(r,{children:"Location"}),e.jsx(r,{children:"Status"}),e.jsx(r,{children:"Date Issued"}),e.jsx(r,{children:"Actions"})]}),e.jsx(Ne,{emptyContent:"No rows to display.",children:L.filter(t=>t.asset_details.some(s=>parseInt(s.archived)===0)).map(t=>t.asset_details.filter(s=>parseInt(s.archived)===0).map((s,S)=>{var c,d,x,u,f,p,g,E,pe;return e.jsxs(be,{children:[e.jsx(n,{children:(c=s.ASSETNUMBER)==null?void 0:c.trim()}),e.jsx(n,{children:(d=s.SYSTEMASSETID)==null?void 0:d.trim()}),e.jsx(n,{children:(x=s.DESCRIPTION)==null?void 0:x.trim()}),e.jsx(n,{children:(u=s.MODEL)==null?void 0:u.trim()}),e.jsx(n,{children:(f=s.SERIALNO)==null?void 0:f.trim()}),e.jsx(n,{children:(p=t.EMPLOYEENAME)==null?void 0:p.trim()}),e.jsx(n,{children:(g=s==null?void 0:s.location.LOCATIONNAME)==null?void 0:g.trim()}),e.jsx(n,{children:e.jsx(Oe,{variant:"flat",color:ge[(E=s.STATUS)==null?void 0:E.trim()]||"default",radius:"md",children:(pe=s.STATUS)==null?void 0:pe.trim()})}),e.jsx(n,{children:s.DATEISSUUED?new Date(s.DATEISSUUED.trim()).toLocaleDateString():"--"}),e.jsx(n,{children:e.jsxs($,{children:[e.jsx(q,{children:e.jsx(l,{isIconOnly:!0,size:"sm",variant:"light",children:e.jsx(Se,{size:20,className:"text-default-800"})})}),e.jsxs(K,{children:[e.jsx(_,{onPress:()=>{O({...t,asset_details:[s]}),se()},children:"View"},"view"),e.jsx(_,{as:je,href:h("assetsextended.edit",s.ASSETNO),children:"Update"},"update"),e.jsx(_,{className:"text-danger",color:"danger",onPress:()=>{O({...t,asset_details:[s]}),We()},children:"Dispose"},"dispose")]})]})})]},s.ASSETNO)}))})]})},"active"),e.jsx(_e,{title:"History",children:e.jsxs(Ee,{isVirtualized:!0,selectedKeys:D,onSelectionChange:C,"aria-label":"Employee Assets table",isStriped:!0,children:[e.jsxs(Ae,{children:[e.jsx(r,{children:"System Asset ID"}),e.jsx(r,{children:"Description"}),e.jsx(r,{children:"Model"}),e.jsx(r,{children:"Serial No"}),e.jsxs(r,{onClick:re,style:{cursor:"pointer"},children:["EMPLOYEE",i==="name_asc"&&" 🔼",i==="name_desc"&&" 🔽",!["name_asc","name_desc"].includes(i)&&" ⏺️"]}),e.jsx(r,{children:"Location"}),e.jsx(r,{children:"Status"}),e.jsx(r,{children:"Date Issued"}),e.jsx(r,{children:"Actions"})]}),e.jsx(Ne,{emptyContent:"No rows to display.",children:L.filter(t=>t.asset_details.some(s=>parseInt(s.archived.trim())===1)).map(t=>t.asset_details.filter(s=>parseInt(s.archived.trim())===1).map((s,S)=>{var c,d,x,u,f,p,g,E;return e.jsxs(be,{children:[e.jsx(n,{children:(c=s.SYSTEMASSETID)==null?void 0:c.trim()}),e.jsx(n,{children:(d=s.DESCRIPTION)==null?void 0:d.trim()}),e.jsx(n,{children:(x=s.MODEL)==null?void 0:x.trim()}),e.jsx(n,{children:(u=s.SERIALNO)==null?void 0:u.trim()}),e.jsx(n,{children:(f=t.EMPLOYEENAME)==null?void 0:f.trim()}),e.jsx(n,{children:(p=s==null?void 0:s.location.LOCATIONNAME)==null?void 0:p.trim()}),e.jsx(n,{children:e.jsx(Oe,{variant:"flat",color:ge[(g=s.STATUS)==null?void 0:g.trim()]||"default",radius:"md",children:(E=s.STATUS)==null?void 0:E.trim()})}),e.jsx(n,{children:s.DATEISSUUED?new Date(s.DATEISSUUED.trim()).toLocaleDateString():"--"}),e.jsx(n,{children:e.jsxs($,{children:[e.jsx(q,{children:e.jsx(l,{isIconOnly:!0,size:"sm",variant:"light",children:e.jsx(Se,{size:20,className:"text-default-800"})})}),e.jsxs(K,{children:[e.jsx(_,{onPress:()=>{O({...t,asset_details:[s]}),se()},children:"View"},"view"),e.jsx(_,{color:"warning",className:"text-warning-500",onPress:()=>es(s.ASSETNO),children:"Restore"},"restore")]})]})})]},s.ASSETNO)}))})]})},"archived")]})}),e.jsx(U,{isOpen:Ue,size:"xl",placement:"top-center",onOpenChange:t=>{t||O(null),ze(t)},children:e.jsx(z,{children:t=>{var s,S,c,d,x,u;return e.jsxs(e.Fragment,{children:[e.jsx(Y,{className:"flex flex-col gap-1",children:"Assets Details"}),e.jsx(V,{children:o&&e.jsxs("div",{className:"flex flex-wrap gap-6",children:[e.jsx(ds,{spaceBetween:10,slidesPerView:1,className:"w-full sm:w-1/2 lg:w-1/3",children:((s=o==null?void 0:o.asset_details[0])==null?void 0:s.IMAGEPATH)&&JSON.parse(o.asset_details[0].IMAGEPATH).map((f,p)=>e.jsx(hs,{children:e.jsx(us,{src:`/storage/${f}`,alt:`Asset Image ${p+1}`,className:"object-cover",width:400,height:200,onError:g=>g.target.src="/assets/placeholder.jpg"})},p))}),e.jsxs("div",{className:"flex-1 space-y-4 text-sm text-gray-700",children:[e.jsxs("p",{children:[e.jsx("span",{className:"font-semibold",children:"Description:"})," ",(S=o.asset_details[0])==null?void 0:S.DESCRIPTION]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-semibold",children:"Serial Number:"})," ",(c=o.asset_details[0])==null?void 0:c.SERIALNO]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-semibold",children:"Date Issued:"})," ",(x=(d=o.asset_details[0])==null?void 0:d.DATEISSUUED)==null?void 0:x.trim()]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-semibold",children:"Condition:"})," ",(u=o.asset_details[0])==null?void 0:u.CONDITIONS]}),e.jsx(l,{color:"primary",variant:"light",onPress:ts,children:"View components"})]})]})}),e.jsx(H,{children:e.jsx(l,{color:"danger",variant:"flat",onPress:t,children:"Close"})})]})}})}),e.jsx(ms,{onComponentModalOpenChange:as,isComponentModalOpen:ss}),e.jsx(U,{isOpen:Ke,onOpenChange:Ge,size:"md",placement:"top-center",children:e.jsx(z,{children:t=>e.jsxs(e.Fragment,{children:[e.jsxs(Y,{className:"flex flex-col gap-1",children:[e.jsx("h1",{className:"text-lg font-semibold",children:"Transfer Assets"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Select a location to transfer the selected assets."})]}),e.jsxs(V,{children:[e.jsx(y,{label:"Select Employee",value:P,onChange:s=>oe(s.target.value),children:B.map((s,S)=>s.EMPLOYEEID?e.jsx(w,{value:s.EMPLOYEEID,children:s.EMPLOYEENAME},s.EMPLOYEEID):null)}),e.jsx(y,{label:"Select Location",value:M,onChange:s=>ne(s.target.value),children:G.map(s=>e.jsx(w,{value:s.LOCATIONID,children:s.LOCATIONNAME},s.LOCATIONID))}),e.jsx(y,{label:"Select Status",value:te,onChange:s=>ae(s.target.value),children:ve.map(s=>e.jsx(w,{value:s.value,children:s.label},s.value))})]}),e.jsxs(H,{children:[e.jsx(l,{color:"danger",variant:"light",onPress:t,children:"Cancel"}),e.jsx(l,{color:"primary",onPress:()=>{Je(Array.from(D),M,P),t()},isDisabled:!M||!P,isLoading:le,children:le?"Transferring...":"Transfer"})]})]})})}),e.jsx(U,{isOpen:Qe,onOpenChange:Xe,placement:"top-center",children:e.jsx(z,{children:t=>e.jsxs(e.Fragment,{children:[e.jsxs(Y,{className:"flex flex-col gap-1",children:[e.jsx("h1",{className:"text-lg font-semibold text-danger-500",children:"Are you sure you want to dispose?"}),e.jsxs(V,{className:"",children:[e.jsx(fe,{isRequired:!0,label:"Reason for disposal",value:F,onChange:s=>ce(s.target.value)}),e.jsx(y,{isRequired:!0,variant:"faded",label:"Select Status",value:xe,onChange:s=>ue(s.target.value),children:ve.map(s=>e.jsx(w,{value:s.value,children:s.label},s.value))}),e.jsx(fe,{variant:"faded",isRequired:!0,label:"Asset Condition",value:R,onChange:s=>de(s.target.value)})]})]}),e.jsxs(H,{children:[e.jsx(l,{color:"danger",variant:"light",onPress:t,children:"Cancel"}),e.jsx(l,{color:"primary",onPress:()=>{Ze(o.asset_details.map(s=>s.ASSETNO)),t()},isDisabled:!F||!R,isLoading:he,children:he?"Disposing...":"Dispose"})]})]})})})]})]})}export{Js as default};
