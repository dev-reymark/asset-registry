import{K as pe,r as d,m as Ne,j as e,L as Ee,$ as Ie,V as N,S as F}from"./app-D2Fc9J7r.js";import{A as Te}from"./Authenticated-Bi7dy8wc.js";import{s as x}from"./index-KE12rTfI.js";import{a as Ce,c as he}from"./statusConstants-B9bmVMgg.js";import{A as $}from"./index-CEg2DTkd.js";import{u as H,m as z,a as B,b as G,c as W,d as J}from"./index-DipQ1G8P.js";import{b as c}from"./chunk-KCYYJJH4-CFnQEN56.js";import{F as ue}from"./chunk-LAX3QLKM-DgxfjCIa.js";import{i as m}from"./chunk-5CAICSBD-C5uePlKw.js";import{s as E,l as I}from"./chunk-2C6KNKEU-DB-baBfx.js";import{i as V}from"./chunk-3TCFMHK3-LtiDXk4l.js";import{t as xe,a as ge,b as T,c as De,d as Ae,e as C}from"./chunk-F3UDT23P-DI8xBlRF.js";import"./useMenuTriggerState-BWe6aKPw.js";import"./index-K8Flc6f-.js";import"./chunk-SLABUSGS-BiRJdjsi.js";import"./index-CbNZw6my.js";import"./LiveAnnouncer-BVsrsiec.js";function Be(){var w;const{assetDetail:a={},assetcomponents:g=[],products:D=[],locations:Z=[],employees:u={},title:A,description:q}=pe().props;console.log("Asset Detail: ",a);const[j,f]=d.useState(!1),{isOpen:Q,onOpen:X,onOpenChange:k}=H(),{isOpen:ee,onOpen:se,onOpenChange:te}=H(),[ae,je]=d.useState([]),[h,P]=d.useState([...a.component_details||[]]),[O,M]=d.useState(""),[v,b]=d.useState(""),{data:o,setData:i,processing:ne,reset:le}=Ne({EMPLOYEEID:a.EMPLOYEEID||"",ASSETID:a.ASSETID||"",ASSETNO:a.ASSETNO||"",PRODUCTID:a.PRODUCTID||"",DESCRIPTION:a.DESCRIPTION||"",MODEL:a.MODEL||"",SERIALNO:a.SERIALNO||"",ISSUEDTO:a.ISSUEDTO||"",DATEISSUUED:a.DATEISSUUED||"",IMAGEPATH:"",STATUS:a.STATUS||"",CONDITIONS:a.CONDITIONS||"",WORKSTATION:a.WORKSTATION||"",TYPESIZE:a.TYPESIZE||"",NOPRINT:a.NOPRINT||"",COMPONENT:a.COMPONENT||"",WITHCOMPONENTS:a.WITHCOMPONENTS||!1,SYSTEMASSETID:a.SYSTEMASSETID||"",SYSTEMCOMPONENTID:"",LOCATIONID:a.LOCATIONID||""}),oe=((w=u==null?void 0:u.EMPLOYEENAME)==null?void 0:w.trim())||"",re=s=>{var Y,K;const t=s.target.value,n=D.find(Se=>String(Se.PRODUCTID)===String(t));i("PRODUCTID",t),i("DESCRIPTION",((Y=n==null?void 0:n.DESCRIPTION)==null?void 0:Y.trim())||"");const l=(K=n==null?void 0:n.asset_component)==null?void 0:K.ASSETCOMPNETID,r=[o.EMPLOYEEID,t,l||null,a.ASSETNUMBER].filter(Boolean).join("-");i("SYSTEMASSETID",r)},ie=()=>{if(!O){N.error("Please select a component.");return}const s=g.find(r=>String(r.ASSETCOMPNETID)===String(O)),l=[...h].filter(r=>String(r.ASSETCOMPNETID)===String(O)).length+1,p={ASSETCOMPNETID:O,COMPONENTNUMBER:l,COMPONENTDESCRIPTION:v,SYSTEMCOMPONENTID:`${o.EMPLOYEEID}-${o.PRODUCTID}-${O}-${l}`,asset_component:s};P(r=>[...r,p]),b(""),M(""),N.success("Component added.")},ce=s=>{P(t=>t.filter((n,l)=>l!==s))},de=async s=>{s.preventDefault(),f(!0);try{const t=new FormData;Object.entries(o).forEach(([n,l])=>{n!=="IMAGEPATH"&&n!=="COMPONENT"&&t.append(n,l??"")}),R.forEach((n,l)=>{t.append(`new_images[${l}]`,n)}),t.append("existing_images",JSON.stringify(S)),t.append("COMPONENT",JSON.stringify(h)),t.append("WITHCOMPONENTS",ae.length>0?"1":"0"),t.append("_method","PUT"),F.post(x("assetsextended.update",a.ASSETNO),t,{forceFormData:!0,preserveScroll:!0,onSuccess:()=>{N.success("Asset updated successfully!"),F.visit(x("assets.index"))},onError:()=>N.error("Failed to update asset.")})}catch{N.error("Unexpected error occurred.")}finally{f(!1)}},[y,_]=d.useState([]),[R,U]=d.useState([]),[S,me]=d.useState(()=>{try{return Array.isArray(a.IMAGEPATH)?a.IMAGEPATH:a.IMAGEPATH?JSON.parse(a.IMAGEPATH):[]}catch{return[]}}),Oe=s=>{const t=Array.from(s.target.files);U(t);const n=t.map(l=>URL.createObjectURL(l));_(n)},L=s=>{const t=R.filter((p,r)=>r!==s),n=y.filter((p,r)=>r!==s),l=S.filter((p,r)=>r!==s);s<S.length?me(l):(s-S.length,U(t),_(n))};return e.jsxs(Te,{children:[e.jsx(Ee,{title:A}),e.jsxs("div",{className:"p-6",children:[e.jsx(c,{as:Ie,href:x("assets.index"),variant:"flat",color:"primary",children:"← Back"}),e.jsx("h2",{className:"text-xl font-bold mt-4",children:A}),e.jsx("p",{className:"text-gray-600 mb-4",children:q}),e.jsxs(ue,{encType:"multipart/form-data",onSubmit:de,className:"w-full max-w-4xl mx-auto space-y-4",children:[e.jsxs("div",{className:"flex w-full gap-4",children:[e.jsx(m,{label:"Employee Name",value:oe,isReadOnly:!0}),e.jsx(E,{label:"Select Product",selectedKeys:[o.PRODUCTID],onSelectionChange:s=>i("PRODUCTID",s.currentKey),onChange:re,children:D.map(s=>e.jsx(I,{value:s.PRODUCTID,children:s.DESCRIPTION},s.PRODUCTID))})]}),e.jsxs("div",{className:"w-full flex gap-4",children:[e.jsx(m,{className:"w-1/2",label:"Description",value:o.DESCRIPTION,readOnly:!0}),e.jsxs(c,{color:"success",variant:"flat",onPress:X,children:["(",h.length,") Components"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(m,{label:"Model",value:o.MODEL,onChange:s=>i("MODEL",s.target.value)}),e.jsx(m,{label:"Serial No.",value:o.SERIALNO,onChange:s=>i("SERIALNO",s.target.value)}),e.jsx(m,{label:"System Asset ID",value:o.SYSTEMASSETID,isReadOnly:!0})]}),e.jsxs("div",{className:"w-full flex gap-4",children:[e.jsx(E,{label:"Status",selectedKeys:o.STATUS?[o.STATUS.trim()]:[],onSelectionChange:s=>i("STATUS",Array.from(s)[0]),children:Ce.map(s=>e.jsx(I,{value:s.value,children:s.label},s.value))}),e.jsx(E,{label:"Condition",selectedKeys:o.CONDITIONS?[o.CONDITIONS.trim()]:[],onSelectionChange:s=>i("CONDITIONS",Array.from(s)[0]),value:o.CONDITIONS,onChange:s=>i("CONDITIONS",s.target.value),children:he.map(s=>e.jsx(I,{value:s.value,children:s.label},s.value))})]}),e.jsxs("div",{className:"w-full flex gap-4",children:[e.jsx(m,{type:"date",label:"Date Issued",value:o.DATEISSUUED,onChange:s=>i("DATEISSUUED",s.target.value)}),e.jsx(E,{label:"Location",selectedKeys:[o.LOCATIONID],onSelectionChange:s=>i("LOCATIONID",s.currentKey),onChange:s=>i("LOCATIONID",s.target.value),children:Z.map(s=>e.jsx(I,{value:s.LOCATIONID,children:s.LOCATIONNAME},s.LOCATIONID))})]}),e.jsxs("div",{className:"flex gap-4 flex-wrap mb-2",children:[S.map((s,t)=>e.jsxs("div",{className:"relative",children:[e.jsx(V,{src:`/storage/${s}`,alt:`Asset Image ${t+1}`,className:"w-32 h-32 object-cover rounded border"}),e.jsx(c,{color:"danger",variant:"light",className:"z-50 absolute top-0 right-0",onPress:()=>L(t),isIconOnly:!0,children:e.jsx($,{className:"size-4"})})]},t)),y.map((s,t)=>e.jsxs("div",{className:"relative",children:[e.jsx(V,{src:s,alt:`New Image Preview ${t+1}`,className:"w-32 h-32 object-cover rounded border"}),e.jsx(c,{color:"danger",variant:"light",isIconOnly:!0,className:"z-50 absolute top-0 right-0",onPress:()=>L(t),children:e.jsx($,{className:"size-4"})})]},t)),e.jsx(m,{type:"file",multiple:!0,accept:"image/*",onChange:Oe})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(c,{color:"primary",type:"submit",isLoading:j,isDisabled:ne,children:j?"Saving...":"Update Asset"}),e.jsx(c,{type:"button",variant:"flat",color:"warning",onPress:le,children:"Reset"})]})]})]}),e.jsx(z,{size:"3xl",isOpen:Q,onOpenChange:k,children:e.jsx(B,{children:s=>e.jsxs(e.Fragment,{children:[e.jsx(G,{children:"Components"}),e.jsx(W,{children:e.jsxs(xe,{"aria-label":"Component Table",topContent:e.jsx(c,{color:"primary",onPress:se,children:"Add New Component"}),children:[e.jsxs(ge,{children:[e.jsx(T,{children:"COMPONENTNUMBER"}),e.jsx(T,{children:"COMPONENTNAME"}),e.jsx(T,{children:"DESCRIPTION"}),e.jsx(T,{children:"SYSTEMCOMPONENTID"}),e.jsx(T,{children:"Actions"})]}),e.jsx(De,{emptyContent:"No components yet.",children:h.map((t,n)=>{var l;return e.jsxs(Ae,{children:[e.jsx(C,{children:t.COMPONENTNUMBER}),e.jsx(C,{children:((l=t.asset_component)==null?void 0:l.ASSETCOMPONENTNAME)||"—"}),e.jsx(C,{children:t.COMPONENTDESCRIPTION}),e.jsx(C,{children:t.SYSTEMCOMPONENTID}),e.jsx(C,{children:e.jsx(c,{size:"sm",color:"danger",variant:"light",onPress:()=>ce(n),children:"Remove"})})]},n)})})]})}),e.jsx(J,{children:e.jsx(c,{color:"danger",variant:"light",onPress:s,children:"Close"})})]})})}),e.jsx(z,{size:"xl",isOpen:ee,onOpenChange:te,children:e.jsx(B,{children:s=>e.jsxs(e.Fragment,{children:[e.jsx(G,{children:"Add Component"}),e.jsxs(W,{children:[e.jsx(E,{label:"Select Component",selectedKeys:[O],onSelectionChange:t=>M(t.currentKey),children:g.map(t=>e.jsx(I,{value:t.ASSETCOMPNETID,children:t.ASSETCOMPONENTNAME},t.ASSETCOMPNETID))}),e.jsx(m,{label:"Component Description",value:v,onChange:t=>b(t.target.value)}),e.jsx(c,{color:"primary",onPress:ie,children:"Add"})]}),e.jsx(J,{children:e.jsx(c,{color:"danger",variant:"light",onPress:s,children:"Close"})})]})})})]})}export{Be as default};
