import{R as _,j as e,L as F,S as y}from"./app-BkmmMbAA.js";import{A as Y}from"./Authenticated-hoGu4jBm.js";import{s as N}from"./index-_IZS0DXX.js";import{C as $}from"./index-DQKMyHZm.js";import{$ as T,l as V,d as B}from"./chunk-47PLNLHE-D5cnP3Oa.js";import{b as q}from"./chunk-KCYYJJH4-BKhZWK96.js";import{t as z,a as H}from"./chunk-ML27DD5T-MUfBAuyG.js";import{t as Q,a as Z,b as d,c as G,d as J,e as g}from"./chunk-F3UDT23P-Bbzy3awn.js";import{p as W}from"./chunk-YHY32LNM-Dtv0G9Q6.js";import{i as X}from"./chunk-5CAICSBD-qVegJHr2.js";import"./index-0-18Hqup.js";import"./useDialog-Ddw4QHMy.js";import"./index-BBiCq9Hm.js";import"./chunk-SLABUSGS-C3PHiHUd.js";import"./index-C-8rcXXa.js";import"./useFilter-BubqJK0g.js";import"./LiveAnnouncer-C4GmY8MF.js";import"./useListState-BLhwxA58.js";import"./index-CokAva9Y.js";import"./features-animation-BTkC1iQv.js";import"./features-max-C-_UBI2W.js";import"./useSingleSelectListState-CG9qY7ZW.js";function ge({histories:m,filters:i,actions:E}){const[b,C]=_.useState(i.search||""),[j,A]=_.useState(i.action||"transfer"),[O,D]=_.useState({start:i.start_date?T(i.start_date+"T00:00[UTC]"):null,end:i.end_date?T(i.end_date+"T23:59[UTC]"):null}),I=m.per_page||10,w=m.last_page||Math.ceil(m.total/I),u=({page:t=1,search:o=null,action:f=null,start_date:x=null,end_date:n=null}={})=>{y.get(N("history.index"),{page:t,search:o??i.search,action:f??i.action,start_date:x??i.start_date,end_date:n??i.end_date},{preserveState:!0,replace:!0})},v=t=>{u({page:t})},L=t=>{C(t.target.value),u({search:t.target.value,page:1})},M=t=>{A(t),u({action:t,page:1})},U=t=>{D(t),t!=null&&t.start&&(t!=null&&t.end)&&u({page:1,start_date:t.start.toString().slice(0,10),end_date:t.end.toString().slice(0,10)})},P=()=>e.jsxs(Q,{isStriped:!0,"aria-label":"Audit log table with pagination",topContent:e.jsxs("div",{className:"flex flex-col gap-4 md:flex-row md:items-center md:justify-between",children:[e.jsx(X,{className:"w-full md:max-w-sm",placeholder:"Search user...",startContent:e.jsx($,{className:"size-5"}),value:b,onChange:L}),e.jsx("div",{className:"w-full flex flex-col gap-4 md:flex-row md:items-center md:justify-end",children:e.jsx(B,{hideTimeZone:!0,label:"Filter by Date",visibleMonths:2,value:O,onChange:U,className:"w-full md:w-auto"})})]}),bottomContent:e.jsx("div",{className:"flex w-full justify-center",children:e.jsx(W,{isCompact:!0,showControls:!0,showShadow:!0,color:"secondary",page:m.current_page,total:w,onChange:v})}),classNames:{wrapper:"min-h-[222px]"},children:[e.jsxs(Z,{children:[e.jsx(d,{children:"User"},"user.name"),e.jsx(d,{children:"Action"},"action"),j==="transfer"||j==="update"?e.jsxs(e.Fragment,{children:[e.jsx(d,{children:"Previous"},"from_changes"),e.jsx(d,{children:"New"},"to_changes")]}):e.jsx(d,{children:"Description"},"changes"),e.jsx(d,{children:"Date Created"},"created_at")]}),e.jsx(G,{items:m.data,emptyContent:"No history found",children:t=>e.jsx(J,{children:o=>{var f,x;if(o==="changes"||o==="from_changes"||o==="to_changes"){const n=t.changes,h=(n==null?void 0:n.from)||{},r=(n==null?void 0:n.to)||{},p={ASSETNUMBER:"Asset Number",EMPLOYEENAME:"Employee Name",SYSTEMASSETID:"System Asset ID",LOCATIONNAME:"Location Name",LOCATIONID:"Location ID",EMPLOYEEID:"Employee ID",STATUS:"Status"},a=[];if(t.action==="archive")a.push(e.jsx("li",{className:"text-red-600 font-semibold",children:"ðŸ“¦ Asset Archived"},"archived_flag")),["SYSTEMASSETID"].forEach(s=>{r[s]&&a.push(e.jsxs("li",{children:[e.jsxs("strong",{children:[p[s]||s,":"]})," ",r[s]]},s))}),h.STATUS!==r.STATUS&&a.push(e.jsxs("li",{children:["Status from"," ",e.jsx("em",{children:h.STATUS||"â€”"})," ","to"," ",e.jsx("strong",{children:r.STATUS||"â€”"})]},"status")),h.CONDITIONS!==r.CONDITIONS&&a.push(e.jsxs("li",{children:["Condition from"," ",e.jsx("em",{children:h.CONDITIONS||"â€”"})," ","to"," ",e.jsx("strong",{children:r.CONDITIONS||"â€”"})]},"conditions")),r.archival_reason&&a.push(e.jsxs("li",{children:["Reason:"," ",e.jsx("strong",{children:r.archival_reason})]},"reason"));else if(t.action==="create")a.push(e.jsx("li",{className:"text-green-600 font-semibold",children:"âœ… Asset Created"},"created_flag")),["SYSTEMASSETID","ASSETNO","EMPLOYEENAME","STATUS","CONDITIONS","LOCATIONID","PRODUCTID","DESCRIPTION","MODEL","SERIALNO","ISSUEDTO","DATEISSUUED"].forEach(s=>{r[s]&&a.push(e.jsxs("li",{children:[e.jsxs("strong",{children:[p[s]||s,":"]})," ",r[s]]},s))}),(f=r.COMPONENTS)!=null&&f.length&&a.push(e.jsxs("li",{className:"mt-2 font-medium",children:["Components:",e.jsx("ul",{className:"list-disc ml-6 text-gray-700",children:r.COMPONENTS.map((s,c)=>e.jsxs("li",{children:[s.ASSETCOMPONENTNAME," ",s.DESCRIPTION?`â€“ ${s.DESCRIPTION}`:""]},c))})]},"components"));else if(t.action==="update")a.push(e.jsx("li",{className:"text-blue-600 font-semibold",children:"âœï¸ Asset Updated"},"updated_flag")),Object.entries(n).forEach(([l,s])=>{const c=(s.from??"").toString().trim(),S=(s.to??"").toString().trim(),R=p[l]||l;c!==S&&a.push(e.jsxs("li",{children:[e.jsxs("strong",{children:[R,":"]})," ",c||"â€”"," ","â†’"," ",S||"â€”"]},l))});else if(t.action==="scanned_qr"){if(a.push(e.jsx("li",{className:"text-indigo-600 font-semibold",children:"ðŸ“· QR Code Scanned"},"scanned_flag")),n.scanned_by&&a.push(e.jsxs("li",{children:[e.jsx("strong",{children:"Scanned By:"})," ",n.scanned_by]},"scanned_by")),n.scanned_at){const l=new Date(n.scanned_at).toLocaleString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"numeric",minute:"2-digit",hour12:!0});a.push(e.jsxs("li",{children:[e.jsx("strong",{children:"Scanned At:"})," ",l]},"scanned_at"))}n.system_asset_id&&a.push(e.jsxs("li",{children:[e.jsx("strong",{children:"System Asset ID:"})," ",n.system_asset_id]},"system_asset_id"))}else Object.keys(r).forEach(l=>{const s=(h[l]??"").toString().trim(),c=(r[l]??"").toString().trim(),S=p[l]||l;s!==c&&a.push(e.jsxs("li",{children:[e.jsxs("strong",{children:["Transferred ",S]})," ","from"," ",e.jsx("em",{children:s||"â€”"})," ","to"," ",e.jsx("strong",{children:c||"â€”"})]},l))});return e.jsx(g,{children:e.jsx("ul",{className:"text-sm space-y-1 max-w-xs overflow-auto",children:a})})}return o==="created_at"?e.jsx(g,{children:new Date(t.created_at).toLocaleString()}):e.jsx(g,{children:o==="user.name"?((x=t.user)==null?void 0:x.name)||"â€”":t[o]})}},t.id)})]});return e.jsxs(Y,{children:[e.jsx(F,{title:"Audit Log"}),e.jsxs("div",{className:"container mx-auto p-4",children:[e.jsx("div",{className:"my-6",children:e.jsx(q,{color:"primary",variant:"flat",as:V,href:N("employees.index"),children:"â† Back"})}),e.jsx("h1",{className:"text-2xl font-bold mb-4",children:"Audit Log"}),e.jsx("div",{className:"flex w-full flex-col",children:e.jsx(z,{"aria-label":"Action tabs",selectedKey:j,onSelectionChange:M,children:E.map(t=>e.jsx(H,{title:t,children:P()},t))})})]})]})}export{ge as default};
