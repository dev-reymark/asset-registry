import{R as S,j as e,L as $,S as V}from"./app-Ccb7qOV4.js";import{A as B}from"./Authenticated-Z2IWSyH2.js";import{s as g}from"./index-CmeuVHow.js";import{C as z}from"./index-DUFpr-eB.js";import{$ as N,d as q}from"./chunk-47PLNLHE-BnNHjl7k.js";import{b as H}from"./chunk-KCYYJJH4-s4EirL7v.js";import{l as Q}from"./chunk-T45N425O-DJRbn8lV.js";import{t as Z,a as G,b as j,c as J,d as W,e as _}from"./chunk-F3UDT23P-BWOiZVf0.js";import{p as X}from"./chunk-YHY32LNM-DhsNwp5n.js";import{i as K}from"./chunk-5CAICSBD-COuyiVOa.js";import{s as k,l as T}from"./chunk-2C6KNKEU-PnoRfBvz.js";import"./index-0-18Hqup.js";import"./useDialog-0fN8-TTN.js";import"./index-B8dVsifH.js";import"./chunk-SLABUSGS-Dx5fQj_d.js";import"./index-B1SFeY3m.js";import"./useFilter-CcYvcKQQ.js";import"./LiveAnnouncer-BKT1_s7_.js";import"./useListState-Cniz5wcE.js";import"./index-CokAva9Y.js";import"./features-animation-Clv54OA7.js";import"./useMenuTriggerState-D_1SE1A9.js";function Te({histories:d,filters:i,actions:E}){const[C,A]=S.useState(d.current_page||1),[b,O]=S.useState(i.search||""),[I,D]=S.useState(i.action||""),[v,w]=S.useState({start:i.start_date?N(i.start_date+"T00:00[UTC]"):null,end:i.end_date?N(i.end_date+"T23:59[UTC]"):null}),L=d.per_page||10,M=d.data,U=d.last_page||Math.ceil(d.total/L),P=t=>{A(t),h({page:t})},h=({page:t=1,search:c=null,action:u=null,start_date:x=null,end_date:n=null}={})=>{V.get(g("history.index"),{page:t,search:c??i.search,action:u??i.action,start_date:x??i.start_date,end_date:n??i.end_date},{preserveState:!0,replace:!0})},R=t=>{O(t.target.value),h({search:t.target.value,page:1})},y=t=>{D(t.target.value),h({action:t.target.value,page:1})},F=t=>{w(t),t!=null&&t.start&&(t!=null&&t.end)&&h({page:1,start_date:t.start.toString().slice(0,10),end_date:t.end.toString().slice(0,10)})};return e.jsxs(B,{children:[e.jsx($,{title:"Audit Log"}),e.jsxs("div",{className:"container mx-auto p-4",children:[e.jsx("div",{className:"my-6",children:e.jsx(H,{color:"primary",variant:"flat",as:Q,href:g("employees.index"),children:"â† Back"})}),e.jsx("h1",{className:"text-2xl font-bold mb-4",children:"Audit Log"}),e.jsxs(Z,{isStriped:!0,"aria-label":"Audit log table with pagination",topContent:e.jsxs("div",{className:"flex flex-col gap-4 md:flex-row md:items-center md:justify-between",children:[e.jsx(K,{className:"w-full md:max-w-sm",placeholder:"Search user...",startContent:e.jsx(z,{className:"size-5"}),value:b,onChange:R}),e.jsxs("div",{className:"w-full flex flex-col gap-4 md:flex-row md:items-center md:justify-end",children:[e.jsx(q,{hideTimeZone:!0,label:"Filter by Date",visibleMonths:2,value:v,onChange:F,className:"w-full md:w-auto"}),e.jsxs(k,{label:"Filter by Action",value:I,onChange:y,size:"sm",className:"w-full md:w-52",children:[e.jsx(T,{value:"",children:"All"},""),E.map(t=>e.jsx(T,{value:t,children:t},t))]})]})]}),bottomContent:e.jsx("div",{className:"flex w-full justify-center",children:e.jsx(X,{isCompact:!0,showControls:!0,showShadow:!0,color:"secondary",page:C,total:U,onChange:P})}),classNames:{wrapper:"min-h-[222px]"},children:[e.jsxs(G,{children:[e.jsx(j,{children:"User"},"user.name"),e.jsx(j,{children:"Action"},"action"),e.jsx(j,{children:"Changes"},"changes"),e.jsx(j,{children:"Date Created"},"created_at")]}),e.jsx(J,{items:M,emptyContent:"No history found",children:t=>e.jsx(W,{children:c=>{var u,x;if(c==="changes"){const n=t.changes,m=(n==null?void 0:n.from)||{},l=(n==null?void 0:n.to)||{},f={ASSETNUMBER:"Asset Number",EMPLOYEENAME:"Employee Name",SYSTEMASSETID:"System Asset ID",LOCATIONNAME:"Location Name",LOCATIONID:"Location ID",EMPLOYEEID:"Employee ID",STATUS:"Status"},a=[];if(t.action==="archive")a.push(e.jsx("li",{className:"text-red-600 font-semibold",children:"ðŸ“¦ Asset Archived"},"archived_flag")),["SYSTEMASSETID"].forEach(s=>{l[s]&&a.push(e.jsxs("li",{children:[e.jsxs("strong",{children:[f[s]||s,":"]})," ",l[s]]},s))}),m.STATUS!==l.STATUS&&a.push(e.jsxs("li",{children:["Status from"," ",e.jsx("em",{children:m.STATUS||"â€”"})," ","to"," ",e.jsx("strong",{children:l.STATUS||"â€”"})]},"status")),m.CONDITIONS!==l.CONDITIONS&&a.push(e.jsxs("li",{children:["Condition from"," ",e.jsx("em",{children:m.CONDITIONS||"â€”"})," ","to"," ",e.jsx("strong",{children:l.CONDITIONS||"â€”"})]},"conditions")),l.archival_reason&&a.push(e.jsxs("li",{children:["Reason:"," ",e.jsx("strong",{children:l.archival_reason})]},"reason"));else if(t.action==="create")a.push(e.jsx("li",{className:"text-green-600 font-semibold",children:"âœ… Asset Created"},"created_flag")),["SYSTEMASSETID","ASSETNO","EMPLOYEENAME","STATUS","CONDITIONS","LOCATIONID","PRODUCTID","DESCRIPTION","MODEL","SERIALNO","ISSUEDTO","DATEISSUUED"].forEach(s=>{l[s]&&a.push(e.jsxs("li",{children:[e.jsxs("strong",{children:[f[s]||s,":"]})," ",l[s]]},s))}),(u=l.COMPONENTS)!=null&&u.length&&a.push(e.jsxs("li",{className:"mt-2 font-medium",children:["Components:",e.jsx("ul",{className:"list-disc ml-6 text-gray-700",children:l.COMPONENTS.map((s,o)=>e.jsxs("li",{children:[s.ASSETCOMPONENTNAME," ",s.DESCRIPTION?`â€“ ${s.DESCRIPTION}`:""]},o))})]},"components"));else if(t.action==="update")a.push(e.jsx("li",{className:"text-blue-600 font-semibold",children:"âœï¸ Asset Updated"},"updated_flag")),Object.entries(n).forEach(([r,s])=>{const o=(s.from??"").toString().trim(),p=(s.to??"").toString().trim(),Y=f[r]||r;o!==p&&a.push(e.jsxs("li",{children:[e.jsxs("strong",{children:[Y,":"]})," ",o||"â€”"," ","â†’"," ",p||"â€”"]},r))});else if(t.action==="scanned_qr"){if(a.push(e.jsx("li",{className:"text-indigo-600 font-semibold",children:"ðŸ“· QR Code Scanned"},"scanned_flag")),n.scanned_by&&a.push(e.jsxs("li",{children:[e.jsx("strong",{children:"Scanned By:"})," ",n.scanned_by]},"scanned_by")),n.scanned_at){const r=new Date(n.scanned_at).toLocaleString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"numeric",minute:"2-digit",hour12:!0});a.push(e.jsxs("li",{children:[e.jsx("strong",{children:"Scanned At:"})," ",r]},"scanned_at"))}n.system_asset_id&&a.push(e.jsxs("li",{children:[e.jsx("strong",{children:"System Asset ID:"})," ",n.system_asset_id]},"system_asset_id"))}else Object.keys(l).forEach(r=>{const s=(m[r]??"").toString().trim(),o=(l[r]??"").toString().trim(),p=f[r]||r;s!==o&&a.push(e.jsxs("li",{children:[e.jsxs("strong",{children:["Transferred"," ",p]})," ","from"," ",e.jsx("em",{children:s||"â€”"})," ","to"," ",e.jsx("strong",{children:o||"â€”"})]},r))});return e.jsx(_,{children:e.jsx("ul",{className:"text-sm space-y-1 max-w-xs overflow-auto",children:a})})}return c==="created_at"?e.jsx(_,{children:new Date(t.created_at).toLocaleString()}):e.jsx(_,{children:c==="user.name"?((x=t.user)==null?void 0:x.name)||"â€”":t[c]})}},t.id)})]})]})]})}export{Te as default};
